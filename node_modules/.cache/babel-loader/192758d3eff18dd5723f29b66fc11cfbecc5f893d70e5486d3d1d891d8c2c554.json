{"ast":null,"code":"import _objectSpread from\"/Users/dbroxton/Documents/Projects/soccer-management-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useEffect}from'react';import{collection,addDoc,setDoc,updateDoc,deleteDoc,doc,query,where,orderBy,onSnapshot,serverTimestamp,increment,arrayRemove,getDocs,getDoc,arrayUnion,deleteField// <--- IMPORT deleteField\n}from\"firebase/firestore\";import{db}from\"../firebase\";import{useAuth}from'./AuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";const ChatContext=/*#__PURE__*/createContext();export const useChat=()=>{return useContext(ChatContext);};export const ChatProvider=_ref=>{let{children}=_ref;const{loggedInUser}=useAuth();const[myChats,setMyChats]=useState([]);// 1. GLOBAL LISTENER\nuseEffect(()=>{if(!loggedInUser){setMyChats([]);return;}const chatsRef=collection(db,\"chats\");const q=query(chatsRef,where(\"visibleTo\",\"array-contains\",loggedInUser.uid),orderBy(\"lastMessageTime\",\"desc\"));const unsubscribe=onSnapshot(q,snapshot=>{const chats=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setMyChats(chats);},error=>{console.error(\"Error listening to chat list:\",error);});return()=>unsubscribe();},[loggedInUser]);// 2. MARK READ\nconst markChatAsRead=async chatId=>{if(!loggedInUser)return;try{const chatRef=doc(db,\"chats\",chatId);await updateDoc(chatRef,{[\"unreadCounts.\".concat(loggedInUser.uid)]:0});}catch(error){console.error(\"Error marking read:\",error);}};// 3. CREATE CHAT\nconst createChat=async function(participantEmails){let chatName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";try{const usersRef=collection(db,\"users\");const participants=[];const participantIds=[loggedInUser.uid];// Add self\nparticipants.push({uid:loggedInUser.uid,name:loggedInUser.playerName,email:loggedInUser.email,photoURL:loggedInUser.photoURL||\"\"});// Resolve other emails\nfor(const email of participantEmails){if(email===loggedInUser.email)continue;const q=query(usersRef,where(\"email\",\"==\",email));const querySnapshot=await getDocs(q);if(!querySnapshot.empty){const userDoc=querySnapshot.docs[0];const userData=userDoc.data();participantIds.push(userDoc.id);participants.push({uid:userDoc.id,name:userData.playerName||\"Unknown\",email:userData.email,photoURL:userData.photoURL||\"\"});}}if(participantIds.length<2){alert(\"Could not find any valid users to chat with.\");return false;}// Check for existing\nconst existingChat=myChats.find(c=>{if(c.participants.length!==participantIds.length)return false;return participantIds.every(id=>c.participants.includes(id));});if(existingChat){const chatRef=doc(db,\"chats\",existingChat.id);if(!existingChat.visibleTo.includes(loggedInUser.uid)){await updateDoc(chatRef,{visibleTo:arrayUnion(loggedInUser.uid)});}return _objectSpread({id:existingChat.id,participants:existingChat.participants,name:existingChat.name},existingChat);}// Create New\nconst initialUnread={};participantIds.forEach(uid=>initialUnread[uid]=0);const docRef=await addDoc(collection(db,\"chats\"),{type:participantIds.length>2?'group':'dm',name:chatName||(participants.length===2?participants[1].name:\"Group Chat\"),participants:participantIds,visibleTo:participantIds,participantDetails:participants,unreadCounts:initialUnread,createdAt:serverTimestamp(),lastMessage:\"Chat created\",lastMessageTime:new Date()});return{id:docRef.id,participants:participantIds,participantDetails:participants};}catch(error){console.error(\"Error creating chat:\",error);alert(\"Error: \"+error.message);return false;}};// 4. SEND MESSAGE\nconst sendMessage=async function(chatId,text,currentParticipants){let imageUrl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;try{await addDoc(collection(db,\"chats\",chatId,\"messages\"),{text:text,imageUrl:imageUrl,senderId:loggedInUser.uid,senderName:loggedInUser.playerName,createdAt:serverTimestamp(),type:'text'});const chatRef=doc(db,\"chats\",chatId);let summary=text;if(imageUrl){summary=text?\"\\uD83D\\uDCF7 \".concat(text):\"ðŸ“· Sent an image\";}const visibleToUpdate=currentParticipants||[loggedInUser.uid];const updatePayload={lastMessage:summary,lastMessageTime:new Date(),visibleTo:visibleToUpdate};const unreadUpdates={};if(currentParticipants){currentParticipants.forEach(uid=>{if(uid!==loggedInUser.uid){unreadUpdates[\"unreadCounts.\".concat(uid)]=increment(1);}});}await updateDoc(chatRef,_objectSpread(_objectSpread({},updatePayload),unreadUpdates));return true;}catch(error){console.error(\"Error sending message:\",error);alert(\"Error: \"+error.message);return false;}};// 5. UPDATE GROUP PHOTO\nconst updateGroupPhoto=async(chatId,photoURL)=>{try{const chatRef=doc(db,\"chats\",chatId);await updateDoc(chatRef,{photoURL:photoURL});const systemMsgText=\"\".concat(loggedInUser.playerName,\" changed the group photo.\");await addDoc(collection(db,\"chats\",chatId,\"messages\"),{text:systemMsgText,type:'system',createdAt:serverTimestamp()});await updateDoc(chatRef,{lastMessage:systemMsgText,lastMessageTime:new Date()});return true;}catch(error){console.error(\"Error updating group photo:\",error);return false;}};// 6. ADD PARTICIPANT (UPDATED)\nconst addParticipant=async(chatId,newEmail,includeHistory)=>{try{const usersRef=collection(db,\"users\");const q=query(usersRef,where(\"email\",\"==\",newEmail));const querySnapshot=await getDocs(q);if(querySnapshot.empty){alert(\"User not found.\");return false;}const userDoc=querySnapshot.docs[0];const newUser={uid:userDoc.id,name:userDoc.data().playerName||\"Unknown\",email:userDoc.data().email,photoURL:userDoc.data().photoURL||\"\"};const chatRef=doc(db,\"chats\",chatId);const chatSnap=await getDoc(chatRef);const chatData=chatSnap.data();if(chatData.participants.includes(newUser.uid)){alert(\"User is already in the group.\");return false;}// Basic Update\nlet updateData={participants:arrayUnion(newUser.uid),visibleTo:arrayUnion(newUser.uid),participantDetails:arrayUnion(newUser),[\"unreadCounts.\".concat(newUser.uid)]:0};// FIXED LOGIC HERE:\nif(!includeHistory){// Hide history -> Set timestamp\nupdateData[\"hiddenHistory.\".concat(newUser.uid)]=serverTimestamp();}else{// Show history -> EXPLICITLY DELETE any old restriction\nupdateData[\"hiddenHistory.\".concat(newUser.uid)]=deleteField();}// 1. Update Chat Doc\nawait updateDoc(chatRef,updateData);// 2. Add System Message\nconst systemMsgText=\"\".concat(loggedInUser.playerName,\" added \").concat(newUser.name,\" to the group.\");await addDoc(collection(db,\"chats\",chatId,\"messages\"),{text:systemMsgText,type:'system',createdAt:serverTimestamp()});// 3. Update Last Message\nawait updateDoc(chatRef,{lastMessage:systemMsgText,lastMessageTime:new Date()});return true;}catch(error){console.error(\"Error adding participant:\",error);alert(\"Error adding user: \"+error.message);return false;}};// 7. LEAVE/HIDE CHAT\nconst hideChat=async(chatId,currentVisibleTo)=>{try{const newVisibleTo=currentVisibleTo.filter(uid=>uid!==loggedInUser.uid);if(newVisibleTo.length===0){const chatRef=doc(db,\"chats\",chatId);await updateDoc(chatRef,{visibleTo:[]});}else{const chatRef=doc(db,\"chats\",chatId);await updateDoc(chatRef,{visibleTo:newVisibleTo});}return true;}catch(error){console.error(\"Error hiding chat:\",error);return false;}};const leaveChat=async chatId=>{try{const chatRef=doc(db,\"chats\",chatId);const chatSnap=await getDoc(chatRef);if(!chatSnap.exists())return false;const chatData=chatSnap.data();const updatedParticipants=chatData.participants.filter(uid=>uid!==loggedInUser.uid);const updatedVisibleTo=chatData.visibleTo.filter(uid=>uid!==loggedInUser.uid);const updatedDetails=chatData.participantDetails.filter(p=>p.uid!==loggedInUser.uid);await updateDoc(chatRef,{participants:updatedParticipants,visibleTo:updatedVisibleTo,participantDetails:updatedDetails});const systemMsgText=\"\".concat(loggedInUser.playerName,\" left the group.\");await addDoc(collection(db,\"chats\",chatId,\"messages\"),{text:systemMsgText,type:'system',createdAt:serverTimestamp()});await updateDoc(chatRef,{lastMessage:systemMsgText,lastMessageTime:new Date()});return true;}catch(error){console.error(\"Error leaving chat:\",error);return false;}};const renameChat=async(chatId,newName)=>{try{const chatRef=doc(db,\"chats\",chatId);await updateDoc(chatRef,{name:newName});return true;}catch(error){console.error(\"Error renaming chat:\",error);return false;}};const value={myChats,createChat,sendMessage,updateGroupPhoto,addParticipant,leaveChat,hideChat,renameChat,markChatAsRead};return/*#__PURE__*/_jsx(ChatContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","collection","addDoc","setDoc","updateDoc","deleteDoc","doc","query","where","orderBy","onSnapshot","serverTimestamp","increment","arrayRemove","getDocs","getDoc","arrayUnion","deleteField","db","useAuth","jsx","_jsx","ChatContext","useChat","ChatProvider","_ref","children","loggedInUser","myChats","setMyChats","chatsRef","q","uid","unsubscribe","snapshot","chats","docs","map","_objectSpread","id","data","error","console","markChatAsRead","chatId","chatRef","concat","createChat","participantEmails","chatName","arguments","length","undefined","usersRef","participants","participantIds","push","name","playerName","email","photoURL","querySnapshot","empty","userDoc","userData","alert","existingChat","find","c","every","includes","visibleTo","initialUnread","forEach","docRef","type","participantDetails","unreadCounts","createdAt","lastMessage","lastMessageTime","Date","message","sendMessage","text","currentParticipants","imageUrl","senderId","senderName","summary","visibleToUpdate","updatePayload","unreadUpdates","updateGroupPhoto","systemMsgText","addParticipant","newEmail","includeHistory","newUser","chatSnap","chatData","updateData","hideChat","currentVisibleTo","newVisibleTo","filter","leaveChat","exists","updatedParticipants","updatedVisibleTo","updatedDetails","p","renameChat","newName","value","Provider"],"sources":["/Users/dbroxton/Documents/Projects/soccer-management-app/src/context/ChatContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { \n  collection, addDoc, setDoc, updateDoc, deleteDoc, doc, \n  query, where, orderBy, onSnapshot, serverTimestamp, increment, \n  arrayRemove, getDocs, getDoc, arrayUnion, deleteField // <--- IMPORT deleteField\n} from \"firebase/firestore\"; \nimport { db } from \"../firebase\"; \nimport { useAuth } from './AuthContext';\n\nconst ChatContext = createContext();\n\nexport const useChat = () => {\n  return useContext(ChatContext);\n};\n\nexport const ChatProvider = ({ children }) => {\n  const { loggedInUser } = useAuth();\n  const [myChats, setMyChats] = useState([]);\n\n  // 1. GLOBAL LISTENER\n  useEffect(() => {\n    if (!loggedInUser) {\n      setMyChats([]);\n      return;\n    }\n\n    const chatsRef = collection(db, \"chats\");\n    const q = query(\n      chatsRef, \n      where(\"visibleTo\", \"array-contains\", loggedInUser.uid), \n      orderBy(\"lastMessageTime\", \"desc\")\n    );\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const chats = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setMyChats(chats);\n    }, (error) => {\n      console.error(\"Error listening to chat list:\", error);\n    });\n\n    return () => unsubscribe();\n  }, [loggedInUser]);\n\n  // 2. MARK READ\n  const markChatAsRead = async (chatId) => {\n    if (!loggedInUser) return;\n    try {\n      const chatRef = doc(db, \"chats\", chatId);\n      await updateDoc(chatRef, {\n        [`unreadCounts.${loggedInUser.uid}`]: 0\n      });\n    } catch (error) {\n      console.error(\"Error marking read:\", error);\n    }\n  };\n\n  // 3. CREATE CHAT\n  const createChat = async (participantEmails, chatName = \"\") => {\n    try {\n      const usersRef = collection(db, \"users\");\n      const participants = [];\n      const participantIds = [loggedInUser.uid];\n\n      // Add self\n      participants.push({\n        uid: loggedInUser.uid,\n        name: loggedInUser.playerName,\n        email: loggedInUser.email,\n        photoURL: loggedInUser.photoURL || \"\" \n      });\n\n      // Resolve other emails\n      for (const email of participantEmails) {\n        if (email === loggedInUser.email) continue; \n        const q = query(usersRef, where(\"email\", \"==\", email));\n        const querySnapshot = await getDocs(q);\n        \n        if (!querySnapshot.empty) {\n          const userDoc = querySnapshot.docs[0];\n          const userData = userDoc.data();\n          participantIds.push(userDoc.id);\n          participants.push({\n            uid: userDoc.id,\n            name: userData.playerName || \"Unknown\",\n            email: userData.email,\n            photoURL: userData.photoURL || \"\" \n          });\n        }\n      }\n\n      if (participantIds.length < 2) {\n        alert(\"Could not find any valid users to chat with.\");\n        return false;\n      }\n\n      // Check for existing\n      const existingChat = myChats.find(c => {\n        if (c.participants.length !== participantIds.length) return false;\n        return participantIds.every(id => c.participants.includes(id));\n      });\n\n      if (existingChat) {\n        const chatRef = doc(db, \"chats\", existingChat.id);\n        if (!existingChat.visibleTo.includes(loggedInUser.uid)) {\n           await updateDoc(chatRef, {\n             visibleTo: arrayUnion(loggedInUser.uid)\n           });\n        }\n        return { \n          id: existingChat.id, \n          participants: existingChat.participants,\n          name: existingChat.name, \n          ...existingChat\n        };\n      }\n\n      // Create New\n      const initialUnread = {};\n      participantIds.forEach(uid => initialUnread[uid] = 0);\n\n      const docRef = await addDoc(collection(db, \"chats\"), {\n        type: participantIds.length > 2 ? 'group' : 'dm',\n        name: chatName || (participants.length === 2 ? participants[1].name : \"Group Chat\"),\n        participants: participantIds,\n        visibleTo: participantIds,\n        participantDetails: participants,\n        unreadCounts: initialUnread,\n        createdAt: serverTimestamp(),\n        lastMessage: \"Chat created\",\n        lastMessageTime: new Date() \n      });\n      \n      return { id: docRef.id, participants: participantIds, participantDetails: participants }; \n\n    } catch (error) {\n      console.error(\"Error creating chat:\", error);\n      alert(\"Error: \" + error.message);\n      return false;\n    }\n  };\n\n  // 4. SEND MESSAGE\n  const sendMessage = async (chatId, text, currentParticipants, imageUrl = null) => {\n    try {\n      await addDoc(collection(db, \"chats\", chatId, \"messages\"), {\n        text: text,\n        imageUrl: imageUrl,\n        senderId: loggedInUser.uid,\n        senderName: loggedInUser.playerName,\n        createdAt: serverTimestamp(),\n        type: 'text'\n      });\n\n      const chatRef = doc(db, \"chats\", chatId);\n      let summary = text;\n      if (imageUrl) {\n        summary = text ? `ðŸ“· ${text}` : \"ðŸ“· Sent an image\";\n      }\n\n      const visibleToUpdate = currentParticipants || [loggedInUser.uid];\n      const updatePayload = {\n        lastMessage: summary,\n        lastMessageTime: new Date(),\n        visibleTo: visibleToUpdate\n      };\n\n      const unreadUpdates = {};\n      if (currentParticipants) {\n        currentParticipants.forEach(uid => {\n          if (uid !== loggedInUser.uid) {\n            unreadUpdates[`unreadCounts.${uid}`] = increment(1);\n          }\n        });\n      }\n\n      await updateDoc(chatRef, { ...updatePayload, ...unreadUpdates });\n      return true;\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      alert(\"Error: \" + error.message);\n      return false;\n    }\n  };\n\n  // 5. UPDATE GROUP PHOTO\n  const updateGroupPhoto = async (chatId, photoURL) => {\n    try {\n      const chatRef = doc(db, \"chats\", chatId);\n      await updateDoc(chatRef, { photoURL: photoURL });\n\n      const systemMsgText = `${loggedInUser.playerName} changed the group photo.`;\n      \n      await addDoc(collection(db, \"chats\", chatId, \"messages\"), {\n        text: systemMsgText,\n        type: 'system',\n        createdAt: serverTimestamp()\n      });\n\n      await updateDoc(chatRef, {\n        lastMessage: systemMsgText,\n        lastMessageTime: new Date()\n      });\n\n      return true;\n    } catch (error) {\n      console.error(\"Error updating group photo:\", error);\n      return false;\n    }\n  };\n\n  // 6. ADD PARTICIPANT (UPDATED)\n  const addParticipant = async (chatId, newEmail, includeHistory) => {\n    try {\n        const usersRef = collection(db, \"users\");\n        const q = query(usersRef, where(\"email\", \"==\", newEmail));\n        const querySnapshot = await getDocs(q);\n\n        if (querySnapshot.empty) {\n            alert(\"User not found.\");\n            return false;\n        }\n\n        const userDoc = querySnapshot.docs[0];\n        const newUser = {\n            uid: userDoc.id,\n            name: userDoc.data().playerName || \"Unknown\",\n            email: userDoc.data().email,\n            photoURL: userDoc.data().photoURL || \"\"\n        };\n\n        const chatRef = doc(db, \"chats\", chatId);\n        const chatSnap = await getDoc(chatRef);\n        const chatData = chatSnap.data();\n\n        if (chatData.participants.includes(newUser.uid)) {\n            alert(\"User is already in the group.\");\n            return false;\n        }\n\n        // Basic Update\n        let updateData = {\n            participants: arrayUnion(newUser.uid),\n            visibleTo: arrayUnion(newUser.uid),\n            participantDetails: arrayUnion(newUser),\n            [`unreadCounts.${newUser.uid}`]: 0\n        };\n\n        // FIXED LOGIC HERE:\n        if (!includeHistory) {\n             // Hide history -> Set timestamp\n             updateData[`hiddenHistory.${newUser.uid}`] = serverTimestamp();\n        } else {\n             // Show history -> EXPLICITLY DELETE any old restriction\n             updateData[`hiddenHistory.${newUser.uid}`] = deleteField();\n        }\n\n        // 1. Update Chat Doc\n        await updateDoc(chatRef, updateData);\n\n        // 2. Add System Message\n        const systemMsgText = `${loggedInUser.playerName} added ${newUser.name} to the group.`;\n        await addDoc(collection(db, \"chats\", chatId, \"messages\"), {\n            text: systemMsgText,\n            type: 'system',\n            createdAt: serverTimestamp()\n        });\n\n        // 3. Update Last Message\n        await updateDoc(chatRef, {\n            lastMessage: systemMsgText,\n            lastMessageTime: new Date()\n        });\n\n        return true;\n    } catch (error) {\n        console.error(\"Error adding participant:\", error);\n        alert(\"Error adding user: \" + error.message);\n        return false;\n    }\n  };\n\n  // 7. LEAVE/HIDE CHAT\n  const hideChat = async (chatId, currentVisibleTo) => {\n    try {\n      const newVisibleTo = currentVisibleTo.filter(uid => uid !== loggedInUser.uid);\n      if (newVisibleTo.length === 0) {\n        const chatRef = doc(db, \"chats\", chatId);\n        await updateDoc(chatRef, { visibleTo: [] });\n      } else {\n        const chatRef = doc(db, \"chats\", chatId);\n        await updateDoc(chatRef, { visibleTo: newVisibleTo });\n      }\n      return true;\n    } catch (error) {\n      console.error(\"Error hiding chat:\", error);\n      return false;\n    }\n  };\n\n  const leaveChat = async (chatId) => {\n    try {\n      const chatRef = doc(db, \"chats\", chatId);\n      const chatSnap = await getDoc(chatRef);\n      if (!chatSnap.exists()) return false;\n\n      const chatData = chatSnap.data();\n      \n      const updatedParticipants = chatData.participants.filter(uid => uid !== loggedInUser.uid);\n      const updatedVisibleTo = chatData.visibleTo.filter(uid => uid !== loggedInUser.uid);\n      const updatedDetails = chatData.participantDetails.filter(p => p.uid !== loggedInUser.uid);\n\n      await updateDoc(chatRef, {\n        participants: updatedParticipants,\n        visibleTo: updatedVisibleTo,\n        participantDetails: updatedDetails\n      });\n\n      const systemMsgText = `${loggedInUser.playerName} left the group.`;\n      await addDoc(collection(db, \"chats\", chatId, \"messages\"), {\n        text: systemMsgText,\n        type: 'system',\n        createdAt: serverTimestamp()\n      });\n      \n      await updateDoc(chatRef, {\n        lastMessage: systemMsgText,\n        lastMessageTime: new Date()\n      });\n\n      return true;\n    } catch (error) {\n      console.error(\"Error leaving chat:\", error);\n      return false;\n    }\n  };\n\n  const renameChat = async (chatId, newName) => {\n    try {\n      const chatRef = doc(db, \"chats\", chatId);\n      await updateDoc(chatRef, { name: newName });\n      return true;\n    } catch (error) {\n      console.error(\"Error renaming chat:\", error);\n      return false;\n    }\n  };\n\n  const value = {\n    myChats,\n    createChat,\n    sendMessage,\n    updateGroupPhoto,\n    addParticipant,\n    leaveChat,\n    hideChat,\n    renameChat,\n    markChatAsRead\n  };\n\n  return (\n    <ChatContext.Provider value={value}>\n      {children}\n    </ChatContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}