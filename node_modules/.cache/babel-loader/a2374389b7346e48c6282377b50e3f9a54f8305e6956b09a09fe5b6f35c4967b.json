{"ast":null,"code":"import _objectSpread from\"/Users/dbroxton/Documents/Projects/soccer-management-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef,useLayoutEffect}from'react';import{createPortal}from'react-dom';import{useAuth}from'../context/AuthContext';import{collection,query,orderBy,onSnapshot,limit,where,getDocs}from\"firebase/firestore\";import{db}from\"../firebase\";import UserSearch from'./UserSearch';import{SquarePen,Send,Paperclip,MoreVertical}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function TeamChat(){const{sendMessage,createChat,hideChat,renameChat,uploadImage,loggedInUser,myChats,markChatAsRead}=useAuth();const[selectedChat,setSelectedChat]=useState(null);const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState(\"\");const[selectedFile,setSelectedFile]=useState(null);const fileInputRef=useRef(null);const[isCreatingChat,setIsCreatingChat]=useState(true);const[selectedEmails,setSelectedEmails]=useState([]);const[newChatName,setNewChatName]=useState(\"\");const[viewingImage,setViewingImage]=useState(null);const[activeChatMenu,setActiveChatMenu]=useState(null);const[activeHeaderMenu,setActiveHeaderMenu]=useState(false);const[userProfiles,setUserProfiles]=useState({});const messagesEndRef=useRef(null);const chatContainerRef=useRef(null);const lastChatIdRef=useRef(null);const[isCollapsed,setIsCollapsed]=useState(window.innerWidth<800);const selectedChatRef=useRef(selectedChat);useEffect(()=>{selectedChatRef.current=selectedChat;},[selectedChat]);useEffect(()=>{const handleResize=()=>{setIsCollapsed(window.innerWidth<800);};window.addEventListener('resize',handleResize);return()=>window.removeEventListener('resize',handleResize);},[]);// FETCH LIVE USER PROFILES\nuseEffect(()=>{const usersRef=collection(db,\"users\");const unsubscribe=onSnapshot(usersRef,snapshot=>{const profiles={};snapshot.docs.forEach(doc=>{profiles[doc.id]=doc.data();});setUserProfiles(profiles);});return()=>unsubscribe();},[]);// LISTEN for messages & Mark Read\nuseEffect(()=>{if(!selectedChat||isCreatingChat){setMessages([]);return;}// Mark read on initial load of chat\nmarkChatAsRead(selectedChat.id);const messagesRef=collection(db,\"chats\",selectedChat.id,\"messages\");const q=query(messagesRef,orderBy(\"createdAt\",\"asc\"),limit(50));const unsubscribe=onSnapshot(q,snapshot=>{const msgs=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setMessages(msgs);// FIX: Mark as read immediately when a new message arrives while viewing\nmarkChatAsRead(selectedChat.id);});return()=>unsubscribe();},[selectedChat,isCreatingChat]);// INSTANT SCROLL\nuseLayoutEffect(()=>{if(selectedChat&&chatContainerRef.current){const isNewChat=lastChatIdRef.current!==selectedChat.id;if(isNewChat){chatContainerRef.current.scrollTop=chatContainerRef.current.scrollHeight;}else if(messagesEndRef.current){messagesEndRef.current.scrollIntoView({behavior:\"smooth\"});}if(messages.length>0){lastChatIdRef.current=selectedChat.id;}}},[messages,selectedChat]);const handleImageLoad=()=>{if(chatContainerRef.current){const{scrollTop,scrollHeight,clientHeight}=chatContainerRef.current;const isNearBottom=scrollHeight-scrollTop-clientHeight<500;if(isNearBottom){chatContainerRef.current.scrollTop=chatContainerRef.current.scrollHeight;}}};const handleFileChange=e=>{if(e.target.files[0]){setSelectedFile(e.target.files[0]);}if(fileInputRef.current){fileInputRef.current.value=\"\";}};const startNewChat=()=>{setIsCreatingChat(true);setSelectedChat(null);setNewChatName(\"\");setSelectedEmails([]);setNewMessage(\"\");setSelectedFile(null);};const handleRenameGroup=async()=>{if(!selectedChat)return;const newName=window.prompt(\"Enter new group name:\",selectedChat.name);if(newName&&newName.trim()!==\"\"){await renameChat(selectedChat.id,newName.trim());}setActiveHeaderMenu(false);};const handleSend=async e=>{e.preventDefault();if(isCreatingChat){if(selectedEmails.length===0){alert(\"Please add at least one person to the chat.\");return;}if(!newMessage.trim()&&!selectedFile){alert(\"Please enter a message or attach a file.\");return;}const chatResult=await createChat(selectedEmails,newChatName);if(chatResult&&chatResult.id){const newChatId=chatResult.id;const participants=chatResult.participants;const text=newMessage;const fileToUpload=selectedFile;const resolvedChatName=chatResult.name||newChatName||\"New Chat\";setNewMessage(\"\");setSelectedFile(null);let imageUrl=null;if(fileToUpload){imageUrl=await uploadImage(fileToUpload,\"chat_images/\".concat(newChatId));}await sendMessage(newChatId,text,participants,imageUrl);const optimisticChat={id:newChatId,name:resolvedChatName,lastMessage:text||\"Sent an image\",type:selectedEmails.length>0?'group':'dm',participants:participants,participantDetails:chatResult.participantDetails||[]};const optimisticMessage={id:'temp-id-'+Date.now(),text:text,imageUrl:imageUrl,senderId:loggedInUser.uid,senderName:loggedInUser.playerName,createdAt:{toDate:()=>new Date()}};setSelectedChat(optimisticChat);setMessages([optimisticMessage]);setIsCreatingChat(false);setNewChatName(\"\");setSelectedEmails([]);}}else{if(!newMessage.trim()&&!selectedFile||!selectedChat)return;const text=newMessage;const fileToUpload=selectedFile;setNewMessage(\"\");setSelectedFile(null);let imageUrl=null;try{if(fileToUpload){imageUrl=await uploadImage(fileToUpload,\"chat_images/\".concat(selectedChat.id));}await sendMessage(selectedChat.id,text,selectedChat.participants,imageUrl);}catch(error){console.error(\"Error sending message/image:\",error);alert(\"Failed to send message.\");}}};const handleDeleteChat=async chat=>{if(chat.type==='roster'){alert(\"Team Roster chats cannot be deleted.\");setActiveChatMenu(null);setActiveHeaderMenu(false);return;}if(window.confirm(\"Are you sure you want to delete this chat? This action cannot be undone.\")){await hideChat(chat.id,chat.visibleTo,chat.type);if(selectedChat&&selectedChat.id===chat.id){setSelectedChat(null);}}setActiveChatMenu(null);setActiveHeaderMenu(false);};const canSendNewChat=isCreatingChat?selectedEmails.length>0&&(newMessage.trim().length>0||selectedFile):true;return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',height:'100%',width:'100%',maxWidth:'1000px',margin:'0 auto',backgroundColor:'#282c34',border:isCollapsed?'none':'1px solid #444',borderRadius:isCollapsed?'0':'8px',overflow:'hidden',boxSizing:'border-box'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:isCollapsed?'80px':'30%',minWidth:isCollapsed?'80px':'250px',transition:'width 0.2s ease, min-width 0.2s ease',backgroundColor:'#282c34',borderRight:'1px solid #444',display:'flex',flexDirection:'column',boxSizing:'border-box'},children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:'15px',borderBottom:'1px solid #444',display:'flex',justifyContent:isCollapsed?'center':'flex-end',alignItems:'center',boxSizing:'border-box'},children:/*#__PURE__*/_jsx(\"button\",{onClick:startNewChat,style:{background:'none',border:'none',color:isCreatingChat?'white':'#61dafb',cursor:'pointer',display:'flex',alignItems:'center'},title:\"Start New Chat\",children:/*#__PURE__*/_jsx(SquarePen,{size:24})})}),/*#__PURE__*/_jsx(\"div\",{style:{overflowY:'auto',flex:1},children:myChats.length===0&&!isCreatingChat?/*#__PURE__*/_jsx(\"p\",{style:{padding:'20px',color:'#888',fontSize:'14px',textAlign:'center'},children:isCollapsed?\"...\":\"No conversations yet.\"}):myChats.map(chat=>{const isDM=chat.type==='dm'||chat.participants&&chat.participants.length===2&&chat.type!=='roster';let displayTitle=chat.name||\"Chat\";let iconImage=null;if(chat.type==='roster'){displayTitle=\"\\u26BD \".concat(chat.name);}else if(isDM){var _chat$participantDeta;const otherUser=(_chat$participantDeta=chat.participantDetails)===null||_chat$participantDeta===void 0?void 0:_chat$participantDeta.find(p=>p.uid!==loggedInUser.uid);if(otherUser){const freshUser=userProfiles[otherUser.uid];if(freshUser){displayTitle=freshUser.playerName||otherUser.name;iconImage=freshUser.photoURL;}else{displayTitle=otherUser.name;iconImage=otherUser.photoURL;}}}const firstLetter=displayTitle.replace(/[^a-zA-Z0-9]/g,'').charAt(0).toUpperCase()||\"?\";// --- UNREAD LOGIC ---\nconst unreadCount=chat.unreadCounts&&chat.unreadCounts[loggedInUser.uid]||0;// FIX: Only show if count > 0 AND we are NOT currently viewing this chat\nconst hasUnread=unreadCount>0&&chat.id!==(selectedChat===null||selectedChat===void 0?void 0:selectedChat.id);return/*#__PURE__*/_jsxs(\"div\",{onClick:()=>{setSelectedChat(chat);setIsCreatingChat(false);},style:{padding:'15px',cursor:'pointer',backgroundColor:(selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)===chat.id&&!isCreatingChat?'#3a3f4a':'transparent',borderBottom:'1px solid #333',display:'flex',justifyContent:isCollapsed?'center':'space-between',alignItems:'center',position:'relative',boxSizing:'border-box'},title:isCollapsed?displayTitle:\"\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:'45px',height:'45px',borderRadius:'50%',marginRight:isCollapsed?'0':'15px',flexShrink:0,backgroundColor:'#444',display:'flex',justifyContent:'center',alignItems:'center',border:'1px solid #555',color:'#eee',fontWeight:'bold',fontSize:'18px',position:'relative'},children:[iconImage?/*#__PURE__*/_jsx(\"img\",{src:iconImage,alt:\"User\",style:{width:'100%',height:'100%',objectFit:'cover',borderRadius:'50%'}}):/*#__PURE__*/_jsx(\"span\",{children:firstLetter}),hasUnread&&/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:'0',right:'0',width:'10px',height:'10px',borderRadius:'50%',backgroundColor:'#61dafb',border:'1px solid #282c34',zIndex:10}})]}),!isCollapsed&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{overflow:'hidden',flex:1,marginRight:'10px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:'bold',color:'white',display:'flex',alignItems:'center',gap:'8px'},children:displayTitle}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:hasUnread?'#eee':'#aaa',fontWeight:hasUnread?'bold':'normal',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'},children:chat.lastMessage})]}),chat.type!=='roster'&&/*#__PURE__*/_jsxs(\"div\",{onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveChatMenu(activeChatMenu===chat.id?null:chat.id),style:{background:'none',border:'none',color:'#aaa',cursor:'pointer',fontSize:'20px',padding:'0 5px'},children:\"\\u22EE\"}),activeChatMenu===chat.id&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',right:'10px',top:'40px',backgroundColor:'#222',border:'1px solid #555',borderRadius:'5px',zIndex:100,minWidth:'120px',boxShadow:'0 2px 10px rgba(0,0,0,0.5)'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteChat(chat),style:{display:'block',width:'100%',padding:'10px',textAlign:'left',background:'none',border:'none',color:'#ff6b6b',cursor:'pointer',borderBottom:'1px solid #333'},children:\"Delete Chat\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveChatMenu(null),style:{display:'block',width:'100%',padding:'10px',textAlign:'left',background:'none',border:'none',color:'#aaa',cursor:'pointer'},children:\"Cancel\"})]})]})]})]},chat.id);})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,display:'flex',flexDirection:'column',backgroundColor:'#1c1e22',minWidth:0,boxSizing:'border-box'},children:[isCreatingChat&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',borderBottom:'1px solid #444',backgroundColor:'#282c34',boxSizing:'border-box'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 15px 0',color:'white'},children:\"New Message\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'5px'},children:/*#__PURE__*/_jsx(UserSearch,{onSelectionChange:setSelectedEmails})})]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,display:'flex',alignItems:'center',justifyContent:'center',color:'#444',fontStyle:'italic'},children:\"Select people to start a new conversation.\"})]}),!isCreatingChat&&selectedChat&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'15px',borderBottom:'1px solid #444',backgroundColor:'#282c34',boxSizing:'border-box',display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"div\",{style:{flex:1,textAlign:'center'},children:(()=>{const isDM=selectedChat.type==='dm'||selectedChat.participants&&selectedChat.participants.length===2;let displayTitle=selectedChat.name;if(isDM){var _selectedChat$partici;const otherUser=(_selectedChat$partici=selectedChat.participantDetails)===null||_selectedChat$partici===void 0?void 0:_selectedChat$partici.find(p=>p.uid!==loggedInUser.uid);if(otherUser){const freshUser=userProfiles[otherUser.uid];displayTitle=freshUser?freshUser.playerName||otherUser.name:otherUser.name;}}let displaySubtext=null;if(!isDM){var _selectedChat$partici2;const others=(_selectedChat$partici2=selectedChat.participantDetails)===null||_selectedChat$partici2===void 0?void 0:_selectedChat$partici2.filter(p=>p.uid!==loggedInUser.uid);if(others&&others.length>0){displaySubtext=others.map(p=>{const fresh=userProfiles[p.uid];return fresh?fresh.playerName||p.name:p.name;}).join(', ');}}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:0},children:displayTitle}),displaySubtext&&/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px',color:'#888'},children:displaySubtext})]});})()}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',marginLeft:'10px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveHeaderMenu(!activeHeaderMenu),style:{background:'none',border:'none',color:'#aaa',cursor:'pointer',display:'flex',alignItems:'center'},children:/*#__PURE__*/_jsx(MoreVertical,{size:24})}),activeHeaderMenu&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',right:'0',top:'35px',backgroundColor:'#222',border:'1px solid #555',borderRadius:'5px',zIndex:100,minWidth:'150px',boxShadow:'0 2px 10px rgba(0,0,0,0.5)'},children:[(selectedChat.type==='group'||selectedChat.participants&&selectedChat.participants.length>2)&&/*#__PURE__*/_jsx(\"button\",{onClick:handleRenameGroup,style:{display:'block',width:'100%',padding:'12px',textAlign:'left',background:'none',border:'none',color:'white',cursor:'pointer',borderBottom:'1px solid #333'},children:\"Rename Group\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteChat(selectedChat),style:{display:'block',width:'100%',padding:'12px',textAlign:'left',background:'none',border:'none',color:'#ff6b6b',cursor:'pointer',borderBottom:'1px solid #333'},children:\"Delete Chat\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveHeaderMenu(false),style:{display:'block',width:'100%',padding:'12px',textAlign:'left',background:'none',border:'none',color:'#aaa',cursor:'pointer'},children:\"Cancel\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{ref:chatContainerRef,style:{flex:1,padding:'20px',overflowY:'auto',display:'flex',flexDirection:'column',gap:'10px',boxSizing:'border-box'},children:[messages.map(msg=>{const isMe=msg.senderId===loggedInUser.uid;return/*#__PURE__*/_jsxs(\"div\",{style:{alignSelf:isMe?'flex-end':'flex-start',maxWidth:'70%'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'10px',color:'#888',marginBottom:'2px',textAlign:isMe?'right':'left'},children:isMe?'Me':msg.senderName}),/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:isMe?'#0078d4':'#3a3f4a',color:'white',padding:'10px 15px',borderRadius:'15px',borderTopRightRadius:isMe?'2px':'15px',borderTopLeftRadius:isMe?'15px':'2px'},children:[msg.imageUrl&&/*#__PURE__*/_jsx(\"img\",{src:msg.imageUrl,alt:\"Attachment\",onLoad:handleImageLoad,onClick:()=>setViewingImage(msg.imageUrl),style:{maxWidth:'100%',maxHeight:'200px',borderRadius:'10px',marginBottom:msg.text?'10px':'0',cursor:'pointer'}}),msg.text&&/*#__PURE__*/_jsx(\"span\",{children:msg.text})]})]},msg.id);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})]}),!isCreatingChat&&!selectedChat&&/*#__PURE__*/_jsx(\"div\",{style:{flex:1,display:'flex',justifyContent:'center',alignItems:'center',color:'#888'},children:\"Select a conversation or start a new one.\"}),(isCreatingChat||selectedChat)&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSend,style:{padding:'15px',backgroundColor:'#282c34',borderTop:'1px solid #444',display:'flex',flexDirection:'column',gap:'10px',width:'100%',boxSizing:'border-box'},children:[selectedFile&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'10px',color:'white',fontSize:'12px',paddingLeft:'10px'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCCE \",selectedFile.name]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setSelectedFile(null),style:{background:'none',border:'none',color:'#ff6b6b',cursor:'pointer'},children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'10px',width:'100%'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",ref:fileInputRef,onChange:handleFileChange,style:{display:'none'}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>fileInputRef.current.click(),style:{padding:'0 15px',borderRadius:'20px',border:'1px solid #555',backgroundColor:'#3a3f4a',color:'white',fontSize:'20px',cursor:'pointer',flexShrink:0,display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(Paperclip,{size:20})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:isCreatingChat?\"Type your first message...\":\"Type a message...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),style:{flex:1,padding:'12px',borderRadius:'20px',border:'none',backgroundColor:'#3a3f4a',color:'white',minWidth:0}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!canSendNewChat,style:{padding:isCollapsed?'10px':'10px 20px',borderRadius:'20px',border:'none',backgroundColor:canSendNewChat?'#61dafb':'#444',color:canSendNewChat?'#000':'#888',fontWeight:'bold',cursor:canSendNewChat?'pointer':'not-allowed',flexShrink:0,display:'flex',alignItems:'center',justifyContent:'center'},children:isCollapsed?/*#__PURE__*/_jsx(Send,{size:20}):\"Send\"})]})]})]}),viewingImage&&/*#__PURE__*/createPortal(/*#__PURE__*/_jsxs(\"div\",{onClick:()=>setViewingImage(null),style:{position:'fixed',top:0,left:0,width:'100%',height:'100%',backgroundColor:'rgba(0, 0, 0, 0.95)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:9999,flexDirection:'column'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();setViewingImage(null);},style:{position:'absolute',top:'40px',right:'20px',width:'50px',height:'50px',borderRadius:'50%',backgroundColor:'rgba(50, 50, 50, 0.8)',border:'2px solid white',color:'white',fontSize:'24px',cursor:'pointer',zIndex:10000,display:'flex',justifyContent:'center',alignItems:'center'},children:\"\\u2715\"}),/*#__PURE__*/_jsx(\"img\",{src:viewingImage,alt:\"Full size\",onClick:e=>e.stopPropagation(),style:{maxWidth:'100%',maxHeight:'85%',objectFit:'contain',boxShadow:'0 0 20px rgba(0,0,0,0.5)'}})]}),document.body)]});}export default TeamChat;","map":{"version":3,"names":["React","useState","useEffect","useRef","useLayoutEffect","createPortal","useAuth","collection","query","orderBy","onSnapshot","limit","where","getDocs","db","UserSearch","SquarePen","Send","Paperclip","MoreVertical","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","TeamChat","sendMessage","createChat","hideChat","renameChat","uploadImage","loggedInUser","myChats","markChatAsRead","selectedChat","setSelectedChat","messages","setMessages","newMessage","setNewMessage","selectedFile","setSelectedFile","fileInputRef","isCreatingChat","setIsCreatingChat","selectedEmails","setSelectedEmails","newChatName","setNewChatName","viewingImage","setViewingImage","activeChatMenu","setActiveChatMenu","activeHeaderMenu","setActiveHeaderMenu","userProfiles","setUserProfiles","messagesEndRef","chatContainerRef","lastChatIdRef","isCollapsed","setIsCollapsed","window","innerWidth","selectedChatRef","current","handleResize","addEventListener","removeEventListener","usersRef","unsubscribe","snapshot","profiles","docs","forEach","doc","id","data","messagesRef","q","msgs","map","_objectSpread","isNewChat","scrollTop","scrollHeight","scrollIntoView","behavior","length","handleImageLoad","clientHeight","isNearBottom","handleFileChange","e","target","files","value","startNewChat","handleRenameGroup","newName","prompt","name","trim","handleSend","preventDefault","alert","chatResult","newChatId","participants","text","fileToUpload","resolvedChatName","imageUrl","concat","optimisticChat","lastMessage","type","participantDetails","optimisticMessage","Date","now","senderId","uid","senderName","playerName","createdAt","toDate","error","console","handleDeleteChat","chat","confirm","visibleTo","canSendNewChat","style","display","height","width","maxWidth","margin","backgroundColor","border","borderRadius","overflow","boxSizing","children","minWidth","transition","borderRight","flexDirection","padding","borderBottom","justifyContent","alignItems","onClick","background","color","cursor","title","size","overflowY","flex","fontSize","textAlign","isDM","displayTitle","iconImage","_chat$participantDeta","otherUser","find","p","freshUser","photoURL","firstLetter","replace","charAt","toUpperCase","unreadCount","unreadCounts","hasUnread","position","marginRight","flexShrink","fontWeight","src","alt","objectFit","top","right","zIndex","gap","whiteSpace","textOverflow","stopPropagation","boxShadow","marginBottom","onSelectionChange","fontStyle","_selectedChat$partici","displaySubtext","_selectedChat$partici2","others","filter","fresh","join","marginLeft","ref","msg","isMe","alignSelf","borderTopRightRadius","borderTopLeftRadius","onLoad","maxHeight","onSubmit","borderTop","paddingLeft","accept","onChange","click","placeholder","disabled","left","document","body"],"sources":["/Users/dbroxton/Documents/Projects/soccer-management-app/src/components/TeamChat.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useLayoutEffect } from 'react';\nimport { createPortal } from 'react-dom'; \nimport { useAuth } from '../context/AuthContext';\nimport { collection, query, orderBy, onSnapshot, limit, where, getDocs } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nimport UserSearch from './UserSearch';\nimport { SquarePen, Send, Paperclip, MoreVertical } from 'lucide-react'; \n\nfunction TeamChat() {\n  const { sendMessage, createChat, hideChat, renameChat, uploadImage, loggedInUser, myChats, markChatAsRead } = useAuth();\n  \n  const [selectedChat, setSelectedChat] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n  \n  const [selectedFile, setSelectedFile] = useState(null);\n  const fileInputRef = useRef(null); \n  \n  const [isCreatingChat, setIsCreatingChat] = useState(true);\n  const [selectedEmails, setSelectedEmails] = useState([]); \n  const [newChatName, setNewChatName] = useState(\"\");\n\n  const [viewingImage, setViewingImage] = useState(null);\n  const [activeChatMenu, setActiveChatMenu] = useState(null);\n  const [activeHeaderMenu, setActiveHeaderMenu] = useState(false);\n\n  const [userProfiles, setUserProfiles] = useState({});\n\n  const messagesEndRef = useRef(null);\n  const chatContainerRef = useRef(null); \n  const lastChatIdRef = useRef(null);    \n\n  const [isCollapsed, setIsCollapsed] = useState(window.innerWidth < 800);\n\n  const selectedChatRef = useRef(selectedChat);\n  useEffect(() => {\n    selectedChatRef.current = selectedChat;\n  }, [selectedChat]);\n\n  useEffect(() => {\n    const handleResize = () => {\n      setIsCollapsed(window.innerWidth < 800);\n    };\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  // FETCH LIVE USER PROFILES\n  useEffect(() => {\n    const usersRef = collection(db, \"users\");\n    const unsubscribe = onSnapshot(usersRef, (snapshot) => {\n      const profiles = {};\n      snapshot.docs.forEach(doc => {\n        profiles[doc.id] = doc.data();\n      });\n      setUserProfiles(profiles);\n    });\n    return () => unsubscribe();\n  }, []);\n\n  // LISTEN for messages & Mark Read\n  useEffect(() => {\n    if (!selectedChat || isCreatingChat) {\n        setMessages([]); \n        return;\n    }\n\n    // Mark read on initial load of chat\n    markChatAsRead(selectedChat.id);\n\n    const messagesRef = collection(db, \"chats\", selectedChat.id, \"messages\");\n    const q = query(messagesRef, orderBy(\"createdAt\", \"asc\"), limit(50));\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const msgs = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setMessages(msgs);\n      \n      // FIX: Mark as read immediately when a new message arrives while viewing\n      markChatAsRead(selectedChat.id);\n    });\n\n    return () => unsubscribe();\n  }, [selectedChat, isCreatingChat]);\n\n  // INSTANT SCROLL\n  useLayoutEffect(() => {\n    if (selectedChat && chatContainerRef.current) {\n      const isNewChat = lastChatIdRef.current !== selectedChat.id;\n      \n      if (isNewChat) {\n        chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n      } else if (messagesEndRef.current) {\n        messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n      }\n\n      if (messages.length > 0) {\n        lastChatIdRef.current = selectedChat.id;\n      }\n    }\n  }, [messages, selectedChat]);\n\n  const handleImageLoad = () => {\n    if (chatContainerRef.current) {\n       const { scrollTop, scrollHeight, clientHeight } = chatContainerRef.current;\n       const isNearBottom = scrollHeight - scrollTop - clientHeight < 500;\n       if (isNearBottom) {\n         chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n       }\n    }\n  };\n\n  const handleFileChange = (e) => {\n    if (e.target.files[0]) {\n      setSelectedFile(e.target.files[0]);\n    }\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  const startNewChat = () => {\n      setIsCreatingChat(true);\n      setSelectedChat(null);\n      setNewChatName(\"\");\n      setSelectedEmails([]);\n      setNewMessage(\"\");\n      setSelectedFile(null);\n  };\n\n  const handleRenameGroup = async () => {\n    if (!selectedChat) return;\n    const newName = window.prompt(\"Enter new group name:\", selectedChat.name);\n    if (newName && newName.trim() !== \"\") {\n      await renameChat(selectedChat.id, newName.trim());\n    }\n    setActiveHeaderMenu(false);\n  };\n\n  const handleSend = async (e) => {\n    e.preventDefault();\n\n    if (isCreatingChat) {\n        if (selectedEmails.length === 0) {\n            alert(\"Please add at least one person to the chat.\");\n            return;\n        }\n        if (!newMessage.trim() && !selectedFile) {\n            alert(\"Please enter a message or attach a file.\");\n            return;\n        }\n\n        const chatResult = await createChat(selectedEmails, newChatName);\n        \n        if (chatResult && chatResult.id) {\n             const newChatId = chatResult.id;\n             const participants = chatResult.participants;\n             const text = newMessage;\n             const fileToUpload = selectedFile;\n\n             const resolvedChatName = chatResult.name || newChatName || \"New Chat\";\n\n             setNewMessage(\"\"); \n             setSelectedFile(null); \n             \n             let imageUrl = null;\n             if (fileToUpload) {\n                 imageUrl = await uploadImage(fileToUpload, `chat_images/${newChatId}`);\n             }\n             \n             await sendMessage(newChatId, text, participants, imageUrl);\n\n             const optimisticChat = {\n                 id: newChatId,\n                 name: resolvedChatName,\n                 lastMessage: text || \"Sent an image\",\n                 type: selectedEmails.length > 0 ? 'group' : 'dm',\n                 participants: participants,\n                 participantDetails: chatResult.participantDetails || [] \n             };\n\n             const optimisticMessage = {\n                 id: 'temp-id-' + Date.now(),\n                 text: text,\n                 imageUrl: imageUrl,\n                 senderId: loggedInUser.uid,\n                 senderName: loggedInUser.playerName,\n                 createdAt: { toDate: () => new Date() }\n             };\n\n             setSelectedChat(optimisticChat);\n             setMessages([optimisticMessage]); \n             setIsCreatingChat(false);\n             setNewChatName(\"\");\n             setSelectedEmails([]);\n        }\n\n    } else {\n        if ((!newMessage.trim() && !selectedFile) || !selectedChat) return;\n\n        const text = newMessage;\n        const fileToUpload = selectedFile;\n\n        setNewMessage(\"\"); \n        setSelectedFile(null); \n        \n        let imageUrl = null;\n\n        try {\n            if (fileToUpload) {\n                imageUrl = await uploadImage(fileToUpload, `chat_images/${selectedChat.id}`);\n            }\n            await sendMessage(selectedChat.id, text, selectedChat.participants, imageUrl);\n        } catch (error) {\n            console.error(\"Error sending message/image:\", error);\n            alert(\"Failed to send message.\");\n        }\n    }\n  };\n\n  const handleDeleteChat = async (chat) => {\n    if (chat.type === 'roster') {\n      alert(\"Team Roster chats cannot be deleted.\");\n      setActiveChatMenu(null); \n      setActiveHeaderMenu(false); \n      return;\n    }\n    \n    if (window.confirm(\"Are you sure you want to delete this chat? This action cannot be undone.\")) {\n        await hideChat(chat.id, chat.visibleTo, chat.type);\n        if (selectedChat && selectedChat.id === chat.id) {\n            setSelectedChat(null);\n        }\n    }\n    setActiveChatMenu(null); \n    setActiveHeaderMenu(false);\n  };\n\n  const canSendNewChat = isCreatingChat \n    ? (selectedEmails.length > 0 && (newMessage.trim().length > 0 || selectedFile)) \n    : true; \n\n  return (\n    <div style={{ \n      display: 'flex', \n      height: '100%', \n      width: '100%', \n      maxWidth: '1000px', \n      margin: '0 auto', \n      backgroundColor: '#282c34', \n      border: isCollapsed ? 'none' : '1px solid #444', \n      borderRadius: isCollapsed ? '0' : '8px', \n      overflow: 'hidden',\n      boxSizing: 'border-box'\n    }}>\n      \n      {/* --- LEFT SIDE: Chat List --- */}\n      <div style={{ \n        width: isCollapsed ? '80px' : '30%', \n        minWidth: isCollapsed ? '80px' : '250px', \n        transition: 'width 0.2s ease, min-width 0.2s ease',\n        backgroundColor: '#282c34', \n        borderRight: '1px solid #444', \n        display: 'flex', \n        flexDirection: 'column',\n        boxSizing: 'border-box'\n      }}>\n        <div style={{ padding: '15px', borderBottom: '1px solid #444', display: 'flex', justifyContent: isCollapsed ? 'center' : 'flex-end', alignItems: 'center', boxSizing: 'border-box' }}>\n          <button \n            onClick={startNewChat}\n            style={{ background: 'none', border: 'none', color: isCreatingChat ? 'white' : '#61dafb', cursor: 'pointer', display: 'flex', alignItems: 'center' }}\n            title=\"Start New Chat\"\n          >\n            <SquarePen size={24} />\n          </button>\n        </div>\n        \n        <div style={{ overflowY: 'auto', flex: 1 }}>\n          {myChats.length === 0 && !isCreatingChat ? (\n            <p style={{ padding: '20px', color: '#888', fontSize: '14px', textAlign: 'center' }}>{isCollapsed ? \"...\" : \"No conversations yet.\"}</p>\n          ) : (\n            myChats.map(chat => {\n              const isDM = chat.type === 'dm' || (chat.participants && chat.participants.length === 2 && chat.type !== 'roster');\n              let displayTitle = chat.name || \"Chat\";\n              let iconImage = null;\n              \n              if (chat.type === 'roster') {\n                  displayTitle = `âš½ ${chat.name}`;\n              } else if (isDM) {\n                  const otherUser = chat.participantDetails?.find(p => p.uid !== loggedInUser.uid);\n                  if (otherUser) {\n                      const freshUser = userProfiles[otherUser.uid];\n                      if (freshUser) {\n                          displayTitle = freshUser.playerName || otherUser.name;\n                          iconImage = freshUser.photoURL;\n                      } else {\n                          displayTitle = otherUser.name;\n                          iconImage = otherUser.photoURL; \n                      }\n                  }\n              }\n              \n              const firstLetter = displayTitle.replace(/[^a-zA-Z0-9]/g, '').charAt(0).toUpperCase() || \"?\";\n              \n              // --- UNREAD LOGIC ---\n              const unreadCount = (chat.unreadCounts && chat.unreadCounts[loggedInUser.uid]) || 0;\n              \n              // FIX: Only show if count > 0 AND we are NOT currently viewing this chat\n              const hasUnread = unreadCount > 0 && chat.id !== selectedChat?.id;\n\n              return (\n                <div \n                  key={chat.id} \n                  onClick={() => { setSelectedChat(chat); setIsCreatingChat(false); }}\n                  style={{ \n                    padding: '15px', \n                    cursor: 'pointer', \n                    backgroundColor: (selectedChat?.id === chat.id && !isCreatingChat) ? '#3a3f4a' : 'transparent',\n                    borderBottom: '1px solid #333',\n                    display: 'flex', \n                    justifyContent: isCollapsed ? 'center' : 'space-between',\n                    alignItems: 'center',\n                    position: 'relative',\n                    boxSizing: 'border-box'\n                  }}\n                  title={isCollapsed ? displayTitle : \"\"}\n                >\n                  <div style={{ \n                       width: '45px', height: '45px', \n                       borderRadius: '50%', \n                       marginRight: isCollapsed ? '0' : '15px', \n                       flexShrink: 0, \n                       backgroundColor: '#444',\n                       display: 'flex', justifyContent: 'center', alignItems: 'center',\n                       border: '1px solid #555',\n                       color: '#eee', fontWeight: 'bold', fontSize: '18px',\n                       position: 'relative'\n                  }}>\n                       {iconImage ? (\n                           <img src={iconImage} alt=\"User\" style={{ width: '100%', height: '100%', objectFit: 'cover', borderRadius: '50%' }} />\n                       ) : (\n                           <span>{firstLetter}</span>\n                       )}\n                       \n                       {/* --- UNREAD BADGE --- */}\n                       {hasUnread && (\n                         <div style={{\n                           position: 'absolute',\n                           top: '0',\n                           right: '0',\n                           width: '10px',\n                           height: '10px',\n                           borderRadius: '50%',\n                           backgroundColor: '#61dafb',\n                           border: '1px solid #282c34',\n                           zIndex: 10\n                         }} />\n                       )}\n                  </div>\n\n                  {!isCollapsed && (\n                    <>\n                      <div style={{ overflow: 'hidden', flex: 1, marginRight: '10px' }}>\n                        <div style={{ fontWeight: 'bold', color: 'white', display: 'flex', alignItems: 'center', gap: '8px' }}>\n                          {displayTitle}\n                        </div>\n                        <div style={{ fontSize: '12px', color: hasUnread ? '#eee' : '#aaa', fontWeight: hasUnread ? 'bold' : 'normal', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\n                          {chat.lastMessage}\n                        </div>\n                      </div>\n                      \n                      {chat.type !== 'roster' && (\n                        <div onClick={(e) => e.stopPropagation()}>\n                          <button \n                            onClick={() => setActiveChatMenu(activeChatMenu === chat.id ? null : chat.id)}\n                            style={{ background: 'none', border: 'none', color: '#aaa', cursor: 'pointer', fontSize: '20px', padding: '0 5px' }}\n                          >\n                            â‹®\n                          </button>\n                          {activeChatMenu === chat.id && (\n                            <div style={{ \n                              position: 'absolute', right: '10px', top: '40px', \n                              backgroundColor: '#222', border: '1px solid #555', borderRadius: '5px', \n                              zIndex: 100, minWidth: '120px', boxShadow: '0 2px 10px rgba(0,0,0,0.5)'\n                            }}>\n                              <button \n                                onClick={() => handleDeleteChat(chat)}\n                                style={{ display: 'block', width: '100%', padding: '10px', textAlign: 'left', background: 'none', border: 'none', color: '#ff6b6b', cursor: 'pointer', borderBottom: '1px solid #333' }}\n                              >\n                                Delete Chat\n                              </button>\n                              <button \n                                onClick={() => setActiveChatMenu(null)}\n                                style={{ display: 'block', width: '100%', padding: '10px', textAlign: 'left', background: 'none', border: 'none', color: '#aaa', cursor: 'pointer' }}\n                              >\n                                Cancel\n                              </button>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              );\n            })\n          )}\n        </div>\n      </div>\n\n      {/* --- RIGHT SIDE: Chat Window OR New Chat Form --- */}\n      <div style={{ \n          flex: 1, \n          display: 'flex', \n          flexDirection: 'column', \n          backgroundColor: '#1c1e22',\n          minWidth: 0, \n          boxSizing: 'border-box'\n      }}>\n        \n        {isCreatingChat && (\n            <>\n                <div style={{ padding: '20px', borderBottom: '1px solid #444', backgroundColor: '#282c34', boxSizing: 'border-box' }}>\n                    <h3 style={{ margin: '0 0 15px 0', color: 'white' }}>New Message</h3>\n                    <div style={{ marginBottom: '5px' }}>\n                         <UserSearch onSelectionChange={setSelectedEmails} />\n                    </div>\n                </div>\n                <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#444', fontStyle: 'italic' }}>\n                    Select people to start a new conversation.\n                </div>\n            </>\n        )}\n\n        {!isCreatingChat && selectedChat && (\n          <>\n            <div style={{ padding: '15px', borderBottom: '1px solid #444', backgroundColor: '#282c34', boxSizing: 'border-box', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n              \n              <div style={{ flex: 1, textAlign: 'center' }}>\n              {(() => {\n                 const isDM = selectedChat.type === 'dm' || (selectedChat.participants && selectedChat.participants.length === 2);\n                 let displayTitle = selectedChat.name;\n                 if (isDM) {\n                     const otherUser = selectedChat.participantDetails?.find(p => p.uid !== loggedInUser.uid);\n                     if (otherUser) {\n                         const freshUser = userProfiles[otherUser.uid];\n                         displayTitle = freshUser ? (freshUser.playerName || otherUser.name) : otherUser.name;\n                     }\n                 }\n                 let displaySubtext = null;\n                 if (!isDM) {\n                     const others = selectedChat.participantDetails?.filter(p => p.uid !== loggedInUser.uid);\n                     if (others && others.length > 0) {\n                         displaySubtext = others.map(p => {\n                             const fresh = userProfiles[p.uid];\n                             return fresh ? (fresh.playerName || p.name) : p.name;\n                         }).join(', ');\n                     }\n                 }\n                 return (\n                    <>\n                        <h3 style={{ margin: 0 }}>{displayTitle}</h3>\n                        {displaySubtext && (\n                            <span style={{ fontSize: '12px', color: '#888' }}>\n                                {displaySubtext}\n                            </span>\n                        )}\n                    </>\n                 );\n              })()}\n              </div>\n\n              <div style={{ position: 'relative', marginLeft: '10px' }}>\n                <button \n                  onClick={() => setActiveHeaderMenu(!activeHeaderMenu)}\n                  style={{ background: 'none', border: 'none', color: '#aaa', cursor: 'pointer', display: 'flex', alignItems: 'center' }}\n                >\n                  <MoreVertical size={24} />\n                </button>\n                \n                {activeHeaderMenu && (\n                  <div style={{ \n                    position: 'absolute', right: '0', top: '35px', \n                    backgroundColor: '#222', border: '1px solid #555', borderRadius: '5px', \n                    zIndex: 100, minWidth: '150px', boxShadow: '0 2px 10px rgba(0,0,0,0.5)'\n                  }}>\n                    {(selectedChat.type === 'group' || (selectedChat.participants && selectedChat.participants.length > 2)) && (\n                        <button \n                          onClick={handleRenameGroup}\n                          style={{ display: 'block', width: '100%', padding: '12px', textAlign: 'left', background: 'none', border: 'none', color: 'white', cursor: 'pointer', borderBottom: '1px solid #333' }}\n                        >\n                          Rename Group\n                        </button>\n                    )}\n                    <button \n                      onClick={() => handleDeleteChat(selectedChat)}\n                      style={{ display: 'block', width: '100%', padding: '12px', textAlign: 'left', background: 'none', border: 'none', color: '#ff6b6b', cursor: 'pointer', borderBottom: '1px solid #333' }}\n                    >\n                      Delete Chat\n                    </button>\n                    <button \n                      onClick={() => setActiveHeaderMenu(false)}\n                      style={{ display: 'block', width: '100%', padding: '12px', textAlign: 'left', background: 'none', border: 'none', color: '#aaa', cursor: 'pointer' }}\n                    >\n                      Cancel\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <div ref={chatContainerRef} style={{ flex: 1, padding: '20px', overflowY: 'auto', display: 'flex', flexDirection: 'column', gap: '10px', boxSizing: 'border-box' }}>\n              {messages.map(msg => {\n                const isMe = msg.senderId === loggedInUser.uid;\n                return (\n                  <div key={msg.id} style={{\n                    alignSelf: isMe ? 'flex-end' : 'flex-start',\n                    maxWidth: '70%',\n                  }}>\n                    <div style={{ fontSize: '10px', color: '#888', marginBottom: '2px', textAlign: isMe ? 'right' : 'left' }}>\n                      {isMe ? 'Me' : msg.senderName}\n                    </div>\n                    <div style={{\n                      backgroundColor: isMe ? '#0078d4' : '#3a3f4a',\n                      color: 'white',\n                      padding: '10px 15px',\n                      borderRadius: '15px',\n                      borderTopRightRadius: isMe ? '2px' : '15px',\n                      borderTopLeftRadius: isMe ? '15px' : '2px'\n                    }}>\n                      {msg.imageUrl && (\n                        <img \n                          src={msg.imageUrl} \n                          alt=\"Attachment\" \n                          onLoad={handleImageLoad} \n                          onClick={() => setViewingImage(msg.imageUrl)}\n                          style={{ maxWidth: '100%', maxHeight: '200px', borderRadius: '10px', marginBottom: msg.text ? '10px' : '0', cursor: 'pointer' }}\n                        />\n                      )}\n                      {msg.text && <span>{msg.text}</span>}\n                    </div>\n                  </div>\n                );\n              })}\n              <div ref={messagesEndRef} />\n            </div>\n          </>\n        )}\n\n        {!isCreatingChat && !selectedChat && (\n             <div style={{ flex: 1, display: 'flex', justifyContent: 'center', alignItems: 'center', color: '#888' }}>\n                Select a conversation or start a new one.\n             </div>\n        )}\n\n        {(isCreatingChat || selectedChat) && (\n            <form onSubmit={handleSend} style={{ \n                padding: '15px', \n                backgroundColor: '#282c34', \n                borderTop: '1px solid #444', \n                display: 'flex', \n                flexDirection: 'column', \n                gap: '10px',\n                width: '100%', \n                boxSizing: 'border-box'\n            }}>\n              {selectedFile && (\n                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', color: 'white', fontSize: '12px', paddingLeft: '10px' }}>\n                  <span>ðŸ“Ž {selectedFile.name}</span>\n                  <button type=\"button\" onClick={() => setSelectedFile(null)} style={{ background: 'none', border: 'none', color: '#ff6b6b', cursor: 'pointer' }}>âœ•</button>\n                </div>\n              )}\n              <div style={{ display: 'flex', gap: '10px', width: '100%' }}>\n                <input \n                  type=\"file\" \n                  accept=\"image/*\"\n                  ref={fileInputRef}\n                  onChange={handleFileChange}\n                  style={{ display: 'none' }}\n                />\n                <button \n                  type=\"button\"\n                  onClick={() => fileInputRef.current.click()}\n                  style={{ \n                    padding: '0 15px', borderRadius: '20px', border: '1px solid #555', \n                    backgroundColor: '#3a3f4a', color: 'white', fontSize: '20px', cursor: 'pointer',\n                    flexShrink: 0,\n                    display: 'flex', alignItems: 'center', justifyContent: 'center'\n                  }}\n                >\n                  <Paperclip size={20} />\n                </button>\n                <input \n                  type=\"text\" \n                  placeholder={isCreatingChat ? \"Type your first message...\" : \"Type a message...\"}\n                  value={newMessage}\n                  onChange={(e) => setNewMessage(e.target.value)}\n                  style={{ \n                      flex: 1, \n                      padding: '12px', \n                      borderRadius: '20px', \n                      border: 'none', \n                      backgroundColor: '#3a3f4a', \n                      color: 'white',\n                      minWidth: 0 \n                  }}\n                />\n                <button \n                    type=\"submit\" \n                    disabled={!canSendNewChat}\n                    style={{ \n                        padding: isCollapsed ? '10px' : '10px 20px', \n                        borderRadius: '20px', \n                        border: 'none', \n                        backgroundColor: canSendNewChat ? '#61dafb' : '#444', \n                        color: canSendNewChat ? '#000' : '#888', \n                        fontWeight: 'bold', \n                        cursor: canSendNewChat ? 'pointer' : 'not-allowed',\n                        flexShrink: 0,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center'\n                    }}\n                >\n                  {isCollapsed ? <Send size={20} /> : \"Send\"}\n                </button>\n              </div>\n            </form>\n        )}\n      </div>\n\n      {viewingImage && createPortal(\n        <div \n          onClick={() => setViewingImage(null)} \n          style={{\n            position: 'fixed', top: 0, left: 0, width: '100%', height: '100%',\n            backgroundColor: 'rgba(0, 0, 0, 0.95)', \n            display: 'flex', justifyContent: 'center', alignItems: 'center', \n            zIndex: 9999, \n            flexDirection: 'column'\n          }}\n        >\n          <button \n            onClick={(e) => {\n              e.stopPropagation(); \n              setViewingImage(null);\n            }}\n            style={{\n              position: 'absolute', \n              top: '40px', \n              right: '20px',\n              width: '50px', \n              height: '50px',\n              borderRadius: '50%',\n              backgroundColor: 'rgba(50, 50, 50, 0.8)', \n              border: '2px solid white', \n              color: 'white', \n              fontSize: '24px', \n              cursor: 'pointer',\n              zIndex: 10000, \n              display: 'flex', justifyContent: 'center', alignItems: 'center'\n            }}\n          >\n            âœ•\n          </button>\n          \n          <img \n            src={viewingImage} \n            alt=\"Full size\" \n            onClick={(e) => e.stopPropagation()} \n            style={{ \n              maxWidth: '100%', \n              maxHeight: '85%', \n              objectFit: 'contain',\n              boxShadow: '0 0 20px rgba(0,0,0,0.5)'\n            }}\n          />\n        </div>,\n        document.body \n      )}\n\n    </div>\n  );\n}\n\nexport default TeamChat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}