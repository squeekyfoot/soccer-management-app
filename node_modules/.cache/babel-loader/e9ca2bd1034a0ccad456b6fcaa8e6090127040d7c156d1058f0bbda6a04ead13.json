{"ast":null,"code":"import _objectSpread from\"/Users/dbroxton/Documents/Projects/soccer-management-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useAuth}from'../context/AuthContext';import{collection,query,orderBy,onSnapshot,limit,where,getDocs}from\"firebase/firestore\";import{db}from\"../firebase\";import UserSearch from'./UserSearch';import{SquarePen,Send}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function TeamChat(){const{sendMessage,createChat,hideChat,uploadImage,loggedInUser}=useAuth();const[myChats,setMyChats]=useState([]);const[selectedChat,setSelectedChat]=useState(null);const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState(\"\");const[selectedFile,setSelectedFile]=useState(null);const fileInputRef=useRef(null);// Inline Creation Mode State\nconst[isCreatingChat,setIsCreatingChat]=useState(true);const[selectedEmails,setSelectedEmails]=useState([]);const[newChatName,setNewChatName]=useState(\"\");const[viewingImage,setViewingImage]=useState(null);const[activeChatMenu,setActiveChatMenu]=useState(null);const messagesEndRef=useRef(null);// Responsive State: Collapsed mode for left column\nconst[isCollapsed,setIsCollapsed]=useState(window.innerWidth<800);// --- FIX: Circular Dependency ---\nconst selectedChatRef=useRef(selectedChat);useEffect(()=>{selectedChatRef.current=selectedChat;},[selectedChat]);// --- RESPONSIVE LISTENER ---\nuseEffect(()=>{const handleResize=()=>{setIsCollapsed(window.innerWidth<800);};window.addEventListener('resize',handleResize);return()=>window.removeEventListener('resize',handleResize);},[]);// 1. REAL-TIME LISTENER FOR CHAT LIST\nuseEffect(()=>{if(!loggedInUser)return;const chatsRef=collection(db,\"chats\");const q=query(chatsRef,where(\"visibleTo\",\"array-contains\",loggedInUser.uid),orderBy(\"lastMessageTime\",\"desc\"));const unsubscribe=onSnapshot(q,snapshot=>{const chats=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setMyChats(chats);// --- FIX: Sync Selected Chat ---\nconst currentSelected=selectedChatRef.current;if(currentSelected){const updatedSelected=chats.find(c=>c.id===currentSelected.id);if(updatedSelected){if(JSON.stringify(updatedSelected)!==JSON.stringify(currentSelected)){setSelectedChat(updatedSelected);}}}},error=>{console.error(\"Error listening to chat list:\",error);});return()=>unsubscribe();},[loggedInUser]);// 2. LISTEN for messages\nuseEffect(()=>{if(!selectedChat||isCreatingChat){setMessages([]);return;}const messagesRef=collection(db,\"chats\",selectedChat.id,\"messages\");const q=query(messagesRef,orderBy(\"createdAt\",\"asc\"),limit(50));const unsubscribe=onSnapshot(q,snapshot=>{const msgs=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setMessages(msgs);scrollToBottom();});return()=>unsubscribe();},[selectedChat,isCreatingChat]);const scrollToBottom=()=>{setTimeout(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});},100);};const handleFileChange=e=>{if(e.target.files[0]){setSelectedFile(e.target.files[0]);}if(fileInputRef.current){fileInputRef.current.value=\"\";}};const startNewChat=()=>{setIsCreatingChat(true);setSelectedChat(null);setNewChatName(\"\");setSelectedEmails([]);setNewMessage(\"\");setSelectedFile(null);};const handleSend=async e=>{e.preventDefault();if(isCreatingChat){if(selectedEmails.length===0){alert(\"Please add at least one person to the chat.\");return;}if(!newMessage.trim()&&!selectedFile){alert(\"Please enter a message or attach a file.\");return;}const chatResult=await createChat(selectedEmails,newChatName);if(chatResult&&chatResult.id){const newChatId=chatResult.id;const participants=chatResult.participants;const text=newMessage;const fileToUpload=selectedFile;const resolvedChatName=chatResult.name||newChatName||\"New Chat\";setNewMessage(\"\");setSelectedFile(null);let imageUrl=null;if(fileToUpload){imageUrl=await uploadImage(fileToUpload,\"chat_images/\".concat(newChatId));}await sendMessage(newChatId,text,participants,imageUrl);const optimisticChat={id:newChatId,name:resolvedChatName,lastMessage:text||\"Sent an image\",type:selectedEmails.length>0?'group':'dm',participants:participants,participantDetails:chatResult.participantDetails||[]};const optimisticMessage={id:'temp-id-'+Date.now(),text:text,imageUrl:imageUrl,senderId:loggedInUser.uid,senderName:loggedInUser.playerName,createdAt:{toDate:()=>new Date()}};setSelectedChat(optimisticChat);setMessages([optimisticMessage]);setIsCreatingChat(false);setNewChatName(\"\");setSelectedEmails([]);}}else{if(!newMessage.trim()&&!selectedFile||!selectedChat)return;const text=newMessage;const fileToUpload=selectedFile;setNewMessage(\"\");setSelectedFile(null);let imageUrl=null;try{if(fileToUpload){imageUrl=await uploadImage(fileToUpload,\"chat_images/\".concat(selectedChat.id));}await sendMessage(selectedChat.id,text,selectedChat.participants,imageUrl);}catch(error){console.error(\"Error sending message/image:\",error);alert(\"Failed to send message.\");}}};const handleDeleteChat=async chat=>{if(chat.type==='roster'){alert(\"Team Roster chats cannot be deleted.\");setActiveChatMenu(null);return;}if(window.confirm(\"Are you sure you want to delete this chat? This action cannot be undone.\")){await hideChat(chat.id,chat.visibleTo,chat.type);if(selectedChat&&selectedChat.id===chat.id){setSelectedChat(null);}}setActiveChatMenu(null);};const canSendNewChat=isCreatingChat?selectedEmails.length>0&&(newMessage.trim().length>0||selectedFile):true;return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',height:'100%',width:'100%',maxWidth:'1000px',margin:'0 auto',backgroundColor:'#282c34',// UPDATED: Remove border on mobile/collapsed to fit flush in the fixed container\nborder:isCollapsed?'none':'1px solid #444',borderRadius:isCollapsed?'0':'8px',overflow:'hidden',boxSizing:'border-box'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:isCollapsed?'80px':'30%',minWidth:isCollapsed?'80px':'250px',transition:'width 0.2s ease, min-width 0.2s ease',backgroundColor:'#282c34',borderRight:'1px solid #444',display:'flex',flexDirection:'column',boxSizing:'border-box'},children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:'15px',borderBottom:'1px solid #444',display:'flex',justifyContent:isCollapsed?'center':'flex-end',alignItems:'center',boxSizing:'border-box'},children:/*#__PURE__*/_jsx(\"button\",{onClick:startNewChat,style:{background:'none',border:'none',color:isCreatingChat?'white':'#61dafb',cursor:'pointer',display:'flex',alignItems:'center'},title:\"Start New Chat\",children:/*#__PURE__*/_jsx(SquarePen,{size:24})})}),/*#__PURE__*/_jsx(\"div\",{style:{overflowY:'auto',flex:1},children:myChats.length===0&&!isCreatingChat?/*#__PURE__*/_jsx(\"p\",{style:{padding:'20px',color:'#888',fontSize:'14px',textAlign:'center'},children:isCollapsed?\"...\":\"No conversations yet.\"}):myChats.map(chat=>{const isDM=chat.type==='dm'||chat.participants&&chat.participants.length===2&&chat.type!=='roster';let displayTitle=chat.name||\"Chat\";let iconImage=null;if(chat.type==='roster'){displayTitle=\"\\u26BD \".concat(chat.name);}else if(isDM){var _chat$participantDeta;const otherUser=(_chat$participantDeta=chat.participantDetails)===null||_chat$participantDeta===void 0?void 0:_chat$participantDeta.find(p=>p.uid!==loggedInUser.uid);if(otherUser){displayTitle=otherUser.name;iconImage=otherUser.photoURL;}}const firstLetter=displayTitle.replace(/[^a-zA-Z0-9]/g,'').charAt(0).toUpperCase()||\"?\";return/*#__PURE__*/_jsxs(\"div\",{onClick:()=>{setSelectedChat(chat);setIsCreatingChat(false);},style:{padding:'15px',cursor:'pointer',backgroundColor:(selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)===chat.id&&!isCreatingChat?'#3a3f4a':'transparent',borderBottom:'1px solid #333',display:'flex',justifyContent:isCollapsed?'center':'space-between',alignItems:'center',position:'relative',boxSizing:'border-box'},title:isCollapsed?displayTitle:\"\",children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'45px',height:'45px',borderRadius:'50%',marginRight:isCollapsed?'0':'15px',flexShrink:0,backgroundColor:'#444',display:'flex',justifyContent:'center',alignItems:'center',overflow:'hidden',border:'1px solid #555',color:'#eee',fontWeight:'bold',fontSize:'18px'},children:iconImage?/*#__PURE__*/_jsx(\"img\",{src:iconImage,alt:\"User\",style:{width:'100%',height:'100%',objectFit:'cover'}}):/*#__PURE__*/_jsx(\"span\",{children:firstLetter})}),!isCollapsed&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{overflow:'hidden',flex:1,marginRight:'10px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:'bold',color:'white'},children:displayTitle}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#aaa',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'},children:chat.lastMessage})]}),chat.type!=='roster'&&/*#__PURE__*/_jsxs(\"div\",{onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveChatMenu(activeChatMenu===chat.id?null:chat.id),style:{background:'none',border:'none',color:'#aaa',cursor:'pointer',fontSize:'20px',padding:'0 5px'},children:\"\\u22EE\"}),activeChatMenu===chat.id&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',right:'10px',top:'40px',backgroundColor:'#222',border:'1px solid #555',borderRadius:'5px',zIndex:100,minWidth:'120px',boxShadow:'0 2px 10px rgba(0,0,0,0.5)'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteChat(chat),style:{display:'block',width:'100%',padding:'10px',textAlign:'left',background:'none',border:'none',color:'#ff6b6b',cursor:'pointer',borderBottom:'1px solid #333'},children:\"Delete Chat\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveChatMenu(null),style:{display:'block',width:'100%',padding:'10px',textAlign:'left',background:'none',border:'none',color:'#aaa',cursor:'pointer'},children:\"Cancel\"})]})]})]})]},chat.id);})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,display:'flex',flexDirection:'column',backgroundColor:'#1c1e22',minWidth:0,boxSizing:'border-box'},children:[isCreatingChat&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',borderBottom:'1px solid #444',backgroundColor:'#282c34',boxSizing:'border-box'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 15px 0',color:'white'},children:\"New Message\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',color:'#aaa',fontSize:'12px'},children:\"TO:\"}),/*#__PURE__*/_jsx(UserSearch,{onSelectionChange:setSelectedEmails})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',color:'#aaa',fontSize:'12px'},children:\"GROUP NAME (OPTIONAL):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newChatName,onChange:e=>setNewChatName(e.target.value),placeholder:\"e.g. Weekend Warriors\",style:{width:'100%',padding:'10px',backgroundColor:'#3a3f4a',border:'none',color:'white',borderRadius:'4px',boxSizing:'border-box'}})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,display:'flex',alignItems:'center',justifyContent:'center',color:'#444',fontStyle:'italic'},children:\"Select people to start a new conversation.\"})]}),!isCreatingChat&&selectedChat&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:'15px',borderBottom:'1px solid #444',backgroundColor:'#282c34',boxSizing:'border-box'},children:(()=>{const isDM=selectedChat.type==='dm'||selectedChat.participants&&selectedChat.participants.length===2;let displayTitle=selectedChat.name;if(isDM){var _selectedChat$partici;const otherUser=(_selectedChat$partici=selectedChat.participantDetails)===null||_selectedChat$partici===void 0?void 0:_selectedChat$partici.find(p=>p.uid!==loggedInUser.uid);if(otherUser)displayTitle=otherUser.name;}let displaySubtext=null;if(!isDM){var _selectedChat$partici2;const others=(_selectedChat$partici2=selectedChat.participantDetails)===null||_selectedChat$partici2===void 0?void 0:_selectedChat$partici2.filter(p=>p.uid!==loggedInUser.uid);if(others&&others.length>0){displaySubtext=others.map(p=>p.name).join(', ');}}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:0},children:displayTitle}),displaySubtext&&/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px',color:'#888'},children:displaySubtext})]});})()}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,padding:'20px',overflowY:'auto',display:'flex',flexDirection:'column',gap:'10px',boxSizing:'border-box'},children:[messages.map(msg=>{const isMe=msg.senderId===loggedInUser.uid;return/*#__PURE__*/_jsxs(\"div\",{style:{alignSelf:isMe?'flex-end':'flex-start',maxWidth:'70%'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'10px',color:'#888',marginBottom:'2px',textAlign:isMe?'right':'left'},children:isMe?'Me':msg.senderName}),/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:isMe?'#0078d4':'#3a3f4a',color:'white',padding:'10px 15px',borderRadius:'15px',borderTopRightRadius:isMe?'2px':'15px',borderTopLeftRadius:isMe?'15px':'2px'},children:[msg.imageUrl&&/*#__PURE__*/_jsx(\"img\",{src:msg.imageUrl,alt:\"Attachment\",onClick:()=>setViewingImage(msg.imageUrl),style:{maxWidth:'100%',maxHeight:'200px',borderRadius:'10px',marginBottom:msg.text?'10px':'0',cursor:'pointer'}}),msg.text&&/*#__PURE__*/_jsx(\"span\",{children:msg.text})]})]},msg.id);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})]}),!isCreatingChat&&!selectedChat&&/*#__PURE__*/_jsx(\"div\",{style:{flex:1,display:'flex',justifyContent:'center',alignItems:'center',color:'#888'},children:\"Select a conversation or start a new one.\"}),(isCreatingChat||selectedChat)&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSend,style:{padding:'15px',backgroundColor:'#282c34',borderTop:'1px solid #444',display:'flex',flexDirection:'column',gap:'10px',width:'100%',boxSizing:'border-box'},children:[selectedFile&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'10px',color:'white',fontSize:'12px',paddingLeft:'10px'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCCE \",selectedFile.name]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setSelectedFile(null),style:{background:'none',border:'none',color:'#ff6b6b',cursor:'pointer'},children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'10px',width:'100%'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",ref:fileInputRef,onChange:handleFileChange,style:{display:'none'}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>fileInputRef.current.click(),style:{padding:'0 15px',borderRadius:'20px',border:'1px solid #555',backgroundColor:'#3a3f4a',color:'white',fontSize:'20px',cursor:'pointer',flexShrink:0},children:\"\\uD83D\\uDCCE\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:isCreatingChat?\"Type your first message...\":\"Type a message...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),style:{flex:1,padding:'12px',borderRadius:'20px',border:'none',backgroundColor:'#3a3f4a',color:'white',minWidth:0}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!canSendNewChat,style:{padding:isCollapsed?'10px':'10px 20px',borderRadius:'20px',border:'none',backgroundColor:canSendNewChat?'#61dafb':'#444',color:canSendNewChat?'#000':'#888',fontWeight:'bold',cursor:canSendNewChat?'pointer':'not-allowed',flexShrink:0,display:'flex',alignItems:'center',justifyContent:'center'},children:isCollapsed?/*#__PURE__*/_jsx(Send,{size:20}):\"Send\"})]})]})]}),viewingImage&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'fixed',top:0,left:0,width:'100%',height:'100%',backgroundColor:'rgba(0, 0, 0, 0.9)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:2000,flexDirection:'column'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setViewingImage(null),style:{position:'absolute',top:'20px',right:'20px',background:'none',border:'none',color:'white',fontSize:'30px',cursor:'pointer'},children:\"\\u2715\"}),/*#__PURE__*/_jsx(\"img\",{src:viewingImage,alt:\"Full size\",style:{maxWidth:'90%',maxHeight:'90%',objectFit:'contain'}})]})]});}export default TeamChat;","map":{"version":3,"names":["React","useState","useEffect","useRef","useAuth","collection","query","orderBy","onSnapshot","limit","where","getDocs","db","UserSearch","SquarePen","Send","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","TeamChat","sendMessage","createChat","hideChat","uploadImage","loggedInUser","myChats","setMyChats","selectedChat","setSelectedChat","messages","setMessages","newMessage","setNewMessage","selectedFile","setSelectedFile","fileInputRef","isCreatingChat","setIsCreatingChat","selectedEmails","setSelectedEmails","newChatName","setNewChatName","viewingImage","setViewingImage","activeChatMenu","setActiveChatMenu","messagesEndRef","isCollapsed","setIsCollapsed","window","innerWidth","selectedChatRef","current","handleResize","addEventListener","removeEventListener","chatsRef","q","uid","unsubscribe","snapshot","chats","docs","map","doc","_objectSpread","id","data","currentSelected","updatedSelected","find","c","JSON","stringify","error","console","messagesRef","msgs","scrollToBottom","setTimeout","_messagesEndRef$curre","scrollIntoView","behavior","handleFileChange","e","target","files","value","startNewChat","handleSend","preventDefault","length","alert","trim","chatResult","newChatId","participants","text","fileToUpload","resolvedChatName","name","imageUrl","concat","optimisticChat","lastMessage","type","participantDetails","optimisticMessage","Date","now","senderId","senderName","playerName","createdAt","toDate","handleDeleteChat","chat","confirm","visibleTo","canSendNewChat","style","display","height","width","maxWidth","margin","backgroundColor","border","borderRadius","overflow","boxSizing","children","minWidth","transition","borderRight","flexDirection","padding","borderBottom","justifyContent","alignItems","onClick","background","color","cursor","title","size","overflowY","flex","fontSize","textAlign","isDM","displayTitle","iconImage","_chat$participantDeta","otherUser","p","photoURL","firstLetter","replace","charAt","toUpperCase","position","marginRight","flexShrink","fontWeight","src","alt","objectFit","whiteSpace","textOverflow","stopPropagation","right","top","zIndex","boxShadow","marginBottom","onSelectionChange","onChange","placeholder","fontStyle","_selectedChat$partici","displaySubtext","_selectedChat$partici2","others","filter","join","gap","msg","isMe","alignSelf","borderTopRightRadius","borderTopLeftRadius","maxHeight","ref","onSubmit","borderTop","paddingLeft","accept","click","disabled","left"],"sources":["/Users/dbroxton/Documents/Projects/soccer-management-app/src/components/TeamChat.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { collection, query, orderBy, onSnapshot, limit, where, getDocs } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nimport UserSearch from './UserSearch';\nimport { SquarePen, Send } from 'lucide-react'; \n\nfunction TeamChat() {\n  const { sendMessage, createChat, hideChat, uploadImage, loggedInUser } = useAuth();\n  \n  const [myChats, setMyChats] = useState([]);\n  const [selectedChat, setSelectedChat] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n  \n  const [selectedFile, setSelectedFile] = useState(null);\n  const fileInputRef = useRef(null); \n  \n  // Inline Creation Mode State\n  const [isCreatingChat, setIsCreatingChat] = useState(true);\n  \n  const [selectedEmails, setSelectedEmails] = useState([]); \n  const [newChatName, setNewChatName] = useState(\"\");\n\n  const [viewingImage, setViewingImage] = useState(null);\n  const [activeChatMenu, setActiveChatMenu] = useState(null);\n  const messagesEndRef = useRef(null);\n\n  // Responsive State: Collapsed mode for left column\n  const [isCollapsed, setIsCollapsed] = useState(window.innerWidth < 800);\n\n  // --- FIX: Circular Dependency ---\n  const selectedChatRef = useRef(selectedChat);\n  useEffect(() => {\n    selectedChatRef.current = selectedChat;\n  }, [selectedChat]);\n\n  // --- RESPONSIVE LISTENER ---\n  useEffect(() => {\n    const handleResize = () => {\n      setIsCollapsed(window.innerWidth < 800);\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  // 1. REAL-TIME LISTENER FOR CHAT LIST\n  useEffect(() => {\n    if (!loggedInUser) return;\n\n    const chatsRef = collection(db, \"chats\");\n    const q = query(\n      chatsRef, \n      where(\"visibleTo\", \"array-contains\", loggedInUser.uid), \n      orderBy(\"lastMessageTime\", \"desc\")\n    );\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const chats = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setMyChats(chats);\n      \n      // --- FIX: Sync Selected Chat ---\n      const currentSelected = selectedChatRef.current;\n      \n      if (currentSelected) {\n        const updatedSelected = chats.find(c => c.id === currentSelected.id);\n        if (updatedSelected) {\n            if (JSON.stringify(updatedSelected) !== JSON.stringify(currentSelected)) {\n                setSelectedChat(updatedSelected);\n            }\n        }\n      }\n\n    }, (error) => {\n      console.error(\"Error listening to chat list:\", error);\n    });\n\n    return () => unsubscribe();\n  }, [loggedInUser]);\n\n  // 2. LISTEN for messages\n  useEffect(() => {\n    if (!selectedChat || isCreatingChat) {\n        setMessages([]); \n        return;\n    }\n\n    const messagesRef = collection(db, \"chats\", selectedChat.id, \"messages\");\n    const q = query(messagesRef, orderBy(\"createdAt\", \"asc\"), limit(50));\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const msgs = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setMessages(msgs);\n      scrollToBottom();\n    });\n\n    return () => unsubscribe();\n  }, [selectedChat, isCreatingChat]);\n\n  const scrollToBottom = () => {\n    setTimeout(() => {\n      messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, 100);\n  };\n\n  const handleFileChange = (e) => {\n    if (e.target.files[0]) {\n      setSelectedFile(e.target.files[0]);\n    }\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  const startNewChat = () => {\n      setIsCreatingChat(true);\n      setSelectedChat(null);\n      setNewChatName(\"\");\n      setSelectedEmails([]);\n      setNewMessage(\"\");\n      setSelectedFile(null);\n  };\n\n  const handleSend = async (e) => {\n    e.preventDefault();\n\n    if (isCreatingChat) {\n        if (selectedEmails.length === 0) {\n            alert(\"Please add at least one person to the chat.\");\n            return;\n        }\n        if (!newMessage.trim() && !selectedFile) {\n            alert(\"Please enter a message or attach a file.\");\n            return;\n        }\n\n        const chatResult = await createChat(selectedEmails, newChatName);\n        \n        if (chatResult && chatResult.id) {\n             const newChatId = chatResult.id;\n             const participants = chatResult.participants;\n             const text = newMessage;\n             const fileToUpload = selectedFile;\n\n             const resolvedChatName = chatResult.name || newChatName || \"New Chat\";\n\n             setNewMessage(\"\"); \n             setSelectedFile(null); \n             \n             let imageUrl = null;\n             if (fileToUpload) {\n                 imageUrl = await uploadImage(fileToUpload, `chat_images/${newChatId}`);\n             }\n             \n             await sendMessage(newChatId, text, participants, imageUrl);\n\n             const optimisticChat = {\n                 id: newChatId,\n                 name: resolvedChatName,\n                 lastMessage: text || \"Sent an image\",\n                 type: selectedEmails.length > 0 ? 'group' : 'dm',\n                 participants: participants,\n                 participantDetails: chatResult.participantDetails || [] \n             };\n\n             const optimisticMessage = {\n                 id: 'temp-id-' + Date.now(),\n                 text: text,\n                 imageUrl: imageUrl,\n                 senderId: loggedInUser.uid,\n                 senderName: loggedInUser.playerName,\n                 createdAt: { toDate: () => new Date() }\n             };\n\n             setSelectedChat(optimisticChat);\n             setMessages([optimisticMessage]); \n             \n             setIsCreatingChat(false);\n             setNewChatName(\"\");\n             setSelectedEmails([]);\n        }\n\n    } else {\n        if ((!newMessage.trim() && !selectedFile) || !selectedChat) return;\n\n        const text = newMessage;\n        const fileToUpload = selectedFile;\n\n        setNewMessage(\"\"); \n        setSelectedFile(null); \n        \n        let imageUrl = null;\n\n        try {\n            if (fileToUpload) {\n                imageUrl = await uploadImage(fileToUpload, `chat_images/${selectedChat.id}`);\n            }\n            await sendMessage(selectedChat.id, text, selectedChat.participants, imageUrl);\n        } catch (error) {\n            console.error(\"Error sending message/image:\", error);\n            alert(\"Failed to send message.\");\n        }\n    }\n  };\n\n  const handleDeleteChat = async (chat) => {\n    if (chat.type === 'roster') {\n      alert(\"Team Roster chats cannot be deleted.\");\n      setActiveChatMenu(null); \n      return;\n    }\n    \n    if (window.confirm(\"Are you sure you want to delete this chat? This action cannot be undone.\")) {\n        await hideChat(chat.id, chat.visibleTo, chat.type);\n        if (selectedChat && selectedChat.id === chat.id) {\n            setSelectedChat(null);\n        }\n    }\n    setActiveChatMenu(null); \n  };\n\n  const canSendNewChat = isCreatingChat \n    ? (selectedEmails.length > 0 && (newMessage.trim().length > 0 || selectedFile)) \n    : true; \n\n  return (\n    <div style={{ \n      display: 'flex', \n      height: '100%', \n      width: '100%', \n      maxWidth: '1000px', \n      margin: '0 auto', \n      backgroundColor: '#282c34', \n      // UPDATED: Remove border on mobile/collapsed to fit flush in the fixed container\n      border: isCollapsed ? 'none' : '1px solid #444', \n      borderRadius: isCollapsed ? '0' : '8px', \n      overflow: 'hidden',\n      boxSizing: 'border-box'\n    }}>\n      \n      {/* --- LEFT SIDE: Chat List --- */}\n      <div style={{ \n        width: isCollapsed ? '80px' : '30%', \n        minWidth: isCollapsed ? '80px' : '250px', \n        transition: 'width 0.2s ease, min-width 0.2s ease',\n        backgroundColor: '#282c34', \n        borderRight: '1px solid #444', \n        display: 'flex', \n        flexDirection: 'column',\n        boxSizing: 'border-box'\n      }}>\n        <div style={{ padding: '15px', borderBottom: '1px solid #444', display: 'flex', justifyContent: isCollapsed ? 'center' : 'flex-end', alignItems: 'center', boxSizing: 'border-box' }}>\n          <button \n            onClick={startNewChat}\n            style={{ background: 'none', border: 'none', color: isCreatingChat ? 'white' : '#61dafb', cursor: 'pointer', display: 'flex', alignItems: 'center' }}\n            title=\"Start New Chat\"\n          >\n            <SquarePen size={24} />\n          </button>\n        </div>\n        \n        <div style={{ overflowY: 'auto', flex: 1 }}>\n          {myChats.length === 0 && !isCreatingChat ? (\n            <p style={{ padding: '20px', color: '#888', fontSize: '14px', textAlign: 'center' }}>{isCollapsed ? \"...\" : \"No conversations yet.\"}</p>\n          ) : (\n            myChats.map(chat => {\n              const isDM = chat.type === 'dm' || (chat.participants && chat.participants.length === 2 && chat.type !== 'roster');\n              let displayTitle = chat.name || \"Chat\";\n              let iconImage = null;\n              \n              if (chat.type === 'roster') {\n                  displayTitle = `âš½ ${chat.name}`;\n              } else if (isDM) {\n                  const otherUser = chat.participantDetails?.find(p => p.uid !== loggedInUser.uid);\n                  if (otherUser) {\n                      displayTitle = otherUser.name;\n                      iconImage = otherUser.photoURL; \n                  }\n              }\n              \n              const firstLetter = displayTitle.replace(/[^a-zA-Z0-9]/g, '').charAt(0).toUpperCase() || \"?\";\n\n              return (\n                <div \n                  key={chat.id} \n                  onClick={() => { setSelectedChat(chat); setIsCreatingChat(false); }}\n                  style={{ \n                    padding: '15px', \n                    cursor: 'pointer', \n                    backgroundColor: (selectedChat?.id === chat.id && !isCreatingChat) ? '#3a3f4a' : 'transparent',\n                    borderBottom: '1px solid #333',\n                    display: 'flex', \n                    justifyContent: isCollapsed ? 'center' : 'space-between',\n                    alignItems: 'center',\n                    position: 'relative',\n                    boxSizing: 'border-box'\n                  }}\n                  title={isCollapsed ? displayTitle : \"\"}\n                >\n                  {/* --- CIRCULAR ICON --- */}\n                  <div style={{ \n                       width: '45px', height: '45px', \n                       borderRadius: '50%', \n                       marginRight: isCollapsed ? '0' : '15px', \n                       flexShrink: 0, \n                       backgroundColor: '#444',\n                       display: 'flex', justifyContent: 'center', alignItems: 'center',\n                       overflow: 'hidden',\n                       border: '1px solid #555',\n                       color: '#eee', fontWeight: 'bold', fontSize: '18px'\n                  }}>\n                       {iconImage ? (\n                           <img src={iconImage} alt=\"User\" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\n                       ) : (\n                           <span>{firstLetter}</span>\n                       )}\n                  </div>\n\n                  {!isCollapsed && (\n                    <>\n                      <div style={{ overflow: 'hidden', flex: 1, marginRight: '10px' }}>\n                        <div style={{ fontWeight: 'bold', color: 'white' }}>\n                          {displayTitle}\n                        </div>\n                        <div style={{ fontSize: '12px', color: '#aaa', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\n                          {chat.lastMessage}\n                        </div>\n                      </div>\n                      \n                      {chat.type !== 'roster' && (\n                        <div onClick={(e) => e.stopPropagation()}>\n                          <button \n                            onClick={() => setActiveChatMenu(activeChatMenu === chat.id ? null : chat.id)}\n                            style={{ background: 'none', border: 'none', color: '#aaa', cursor: 'pointer', fontSize: '20px', padding: '0 5px' }}\n                          >\n                            â‹®\n                          </button>\n                          {activeChatMenu === chat.id && (\n                            <div style={{ \n                              position: 'absolute', right: '10px', top: '40px', \n                              backgroundColor: '#222', border: '1px solid #555', borderRadius: '5px', \n                              zIndex: 100, minWidth: '120px', boxShadow: '0 2px 10px rgba(0,0,0,0.5)'\n                            }}>\n                              <button \n                                onClick={() => handleDeleteChat(chat)}\n                                style={{ display: 'block', width: '100%', padding: '10px', textAlign: 'left', background: 'none', border: 'none', color: '#ff6b6b', cursor: 'pointer', borderBottom: '1px solid #333' }}\n                              >\n                                Delete Chat\n                              </button>\n                              <button \n                                onClick={() => setActiveChatMenu(null)}\n                                style={{ display: 'block', width: '100%', padding: '10px', textAlign: 'left', background: 'none', border: 'none', color: '#aaa', cursor: 'pointer' }}\n                              >\n                                Cancel\n                              </button>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              );\n            })\n          )}\n        </div>\n      </div>\n\n      {/* --- RIGHT SIDE: Chat Window OR New Chat Form --- */}\n      <div style={{ \n          flex: 1, \n          display: 'flex', \n          flexDirection: 'column', \n          backgroundColor: '#1c1e22',\n          minWidth: 0, \n          boxSizing: 'border-box'\n      }}>\n        \n        {/* CASE 1: Creating New Chat */}\n        {isCreatingChat && (\n            <>\n                <div style={{ padding: '20px', borderBottom: '1px solid #444', backgroundColor: '#282c34', boxSizing: 'border-box' }}>\n                    <h3 style={{ margin: '0 0 15px 0', color: 'white' }}>New Message</h3>\n                    \n                    <div style={{ marginBottom: '15px' }}>\n                         <label style={{ display: 'block', marginBottom: '5px', color: '#aaa', fontSize: '12px' }}>TO:</label>\n                         <UserSearch onSelectionChange={setSelectedEmails} />\n                    </div>\n\n                    <div>\n                         <label style={{ display: 'block', marginBottom: '5px', color: '#aaa', fontSize: '12px' }}>GROUP NAME (OPTIONAL):</label>\n                         <input \n                            type=\"text\" \n                            value={newChatName} \n                            onChange={(e) => setNewChatName(e.target.value)}\n                            placeholder=\"e.g. Weekend Warriors\"\n                            style={{ width: '100%', padding: '10px', backgroundColor: '#3a3f4a', border: 'none', color: 'white', borderRadius: '4px', boxSizing: 'border-box' }}\n                         />\n                    </div>\n                </div>\n                \n                <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#444', fontStyle: 'italic' }}>\n                    Select people to start a new conversation.\n                </div>\n            </>\n        )}\n\n        {/* CASE 2: Viewing Existing Chat */}\n        {!isCreatingChat && selectedChat && (\n          <>\n            <div style={{ padding: '15px', borderBottom: '1px solid #444', backgroundColor: '#282c34', boxSizing: 'border-box' }}>\n              {(() => {\n                 const isDM = selectedChat.type === 'dm' || (selectedChat.participants && selectedChat.participants.length === 2);\n                 let displayTitle = selectedChat.name;\n                 if (isDM) {\n                     const otherUser = selectedChat.participantDetails?.find(p => p.uid !== loggedInUser.uid);\n                     if (otherUser) displayTitle = otherUser.name;\n                 }\n\n                 let displaySubtext = null;\n                 if (!isDM) {\n                     const others = selectedChat.participantDetails?.filter(p => p.uid !== loggedInUser.uid);\n                     if (others && others.length > 0) {\n                         displaySubtext = others.map(p => p.name).join(', ');\n                     }\n                 }\n\n                 return (\n                    <>\n                        <h3 style={{ margin: 0 }}>{displayTitle}</h3>\n                        {displaySubtext && (\n                            <span style={{ fontSize: '12px', color: '#888' }}>\n                                {displaySubtext}\n                            </span>\n                        )}\n                    </>\n                 );\n              })()}\n            </div>\n\n            <div style={{ flex: 1, padding: '20px', overflowY: 'auto', display: 'flex', flexDirection: 'column', gap: '10px', boxSizing: 'border-box' }}>\n              {messages.map(msg => {\n                const isMe = msg.senderId === loggedInUser.uid;\n                return (\n                  <div key={msg.id} style={{\n                    alignSelf: isMe ? 'flex-end' : 'flex-start',\n                    maxWidth: '70%',\n                  }}>\n                    <div style={{ fontSize: '10px', color: '#888', marginBottom: '2px', textAlign: isMe ? 'right' : 'left' }}>\n                      {isMe ? 'Me' : msg.senderName}\n                    </div>\n                    <div style={{\n                      backgroundColor: isMe ? '#0078d4' : '#3a3f4a',\n                      color: 'white',\n                      padding: '10px 15px',\n                      borderRadius: '15px',\n                      borderTopRightRadius: isMe ? '2px' : '15px',\n                      borderTopLeftRadius: isMe ? '15px' : '2px'\n                    }}>\n                      {msg.imageUrl && (\n                        <img \n                          src={msg.imageUrl} \n                          alt=\"Attachment\" \n                          onClick={() => setViewingImage(msg.imageUrl)}\n                          style={{ maxWidth: '100%', maxHeight: '200px', borderRadius: '10px', marginBottom: msg.text ? '10px' : '0', cursor: 'pointer' }}\n                        />\n                      )}\n                      {msg.text && <span>{msg.text}</span>}\n                    </div>\n                  </div>\n                );\n              })}\n              <div ref={messagesEndRef} />\n            </div>\n          </>\n        )}\n\n        {/* CASE 3: No Selection */}\n        {!isCreatingChat && !selectedChat && (\n             <div style={{ flex: 1, display: 'flex', justifyContent: 'center', alignItems: 'center', color: '#888' }}>\n                Select a conversation or start a new one.\n             </div>\n        )}\n\n        {/* INPUT AREA */}\n        {(isCreatingChat || selectedChat) && (\n            <form onSubmit={handleSend} style={{ \n                padding: '15px', \n                backgroundColor: '#282c34', \n                borderTop: '1px solid #444', \n                display: 'flex', \n                flexDirection: 'column', \n                gap: '10px',\n                width: '100%', \n                boxSizing: 'border-box'\n            }}>\n              \n              {selectedFile && (\n                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', color: 'white', fontSize: '12px', paddingLeft: '10px' }}>\n                  <span>ðŸ“Ž {selectedFile.name}</span>\n                  <button type=\"button\" onClick={() => setSelectedFile(null)} style={{ background: 'none', border: 'none', color: '#ff6b6b', cursor: 'pointer' }}>âœ•</button>\n                </div>\n              )}\n\n              <div style={{ display: 'flex', gap: '10px', width: '100%' }}>\n                <input \n                  type=\"file\" \n                  accept=\"image/*\"\n                  ref={fileInputRef}\n                  onChange={handleFileChange}\n                  style={{ display: 'none' }}\n                />\n                \n                <button \n                  type=\"button\"\n                  onClick={() => fileInputRef.current.click()}\n                  style={{ \n                    padding: '0 15px', borderRadius: '20px', border: '1px solid #555', \n                    backgroundColor: '#3a3f4a', color: 'white', fontSize: '20px', cursor: 'pointer',\n                    flexShrink: 0\n                  }}\n                >\n                  ðŸ“Ž\n                </button>\n\n                <input \n                  type=\"text\" \n                  placeholder={isCreatingChat ? \"Type your first message...\" : \"Type a message...\"}\n                  value={newMessage}\n                  onChange={(e) => setNewMessage(e.target.value)}\n                  style={{ \n                      flex: 1, \n                      padding: '12px', \n                      borderRadius: '20px', \n                      border: 'none', \n                      backgroundColor: '#3a3f4a', \n                      color: 'white',\n                      minWidth: 0 \n                  }}\n                />\n                <button \n                    type=\"submit\" \n                    disabled={!canSendNewChat}\n                    style={{ \n                        padding: isCollapsed ? '10px' : '10px 20px', \n                        borderRadius: '20px', \n                        border: 'none', \n                        backgroundColor: canSendNewChat ? '#61dafb' : '#444', \n                        color: canSendNewChat ? '#000' : '#888', \n                        fontWeight: 'bold', \n                        cursor: canSendNewChat ? 'pointer' : 'not-allowed',\n                        flexShrink: 0,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center'\n                    }}\n                >\n                  {isCollapsed ? <Send size={20} /> : \"Send\"}\n                </button>\n              </div>\n            </form>\n        )}\n      </div>\n\n      {/* --- IMAGE VIEWER MODAL --- */}\n      {viewingImage && (\n        <div style={{\n          position: 'fixed', top: 0, left: 0, width: '100%', height: '100%',\n          backgroundColor: 'rgba(0, 0, 0, 0.9)',\n          display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 2000,\n          flexDirection: 'column'\n        }}>\n          <button \n            onClick={() => setViewingImage(null)}\n            style={{\n              position: 'absolute', top: '20px', right: '20px',\n              background: 'none', border: 'none', color: 'white', fontSize: '30px', cursor: 'pointer'\n            }}\n          >\n            âœ•\n          </button>\n          <img \n            src={viewingImage} \n            alt=\"Full size\" \n            style={{ maxWidth: '90%', maxHeight: '90%', objectFit: 'contain' }}\n          />\n        </div>\n      )}\n\n    </div>\n  );\n}\n\nexport default TeamChat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}