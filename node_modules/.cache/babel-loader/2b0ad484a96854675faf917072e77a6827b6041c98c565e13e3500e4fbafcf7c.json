{"ast":null,"code":"var _jsxFileName = \"/Users/dbroxton/Documents/Projects/soccer-management-app/src/context/AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, updateEmail, updateProfile as firebaseUpdateProfile, EmailAuthProvider, reauthenticateWithCredential, deleteUser } from \"firebase/auth\";\nimport { doc, getDoc, setDoc, updateDoc, collection, addDoc, getDocs, deleteDoc, query, where, arrayUnion, arrayRemove, orderBy, serverTimestamp } from \"firebase/firestore\";\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from \"firebase/storage\";\nimport { auth, db, storage } from \"../firebase\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [loggedInUser, setLoggedInUser] = useState(null);\n  const [soccerDetails, setSoccerDetails] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [needsReauth, setNeedsReauth] = useState(false);\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async user => {\n      if (user) {\n        const userDocRef = doc(db, \"users\", user.uid);\n        const userDoc = await getDoc(userDocRef);\n        const soccerDocRef = doc(db, \"users\", user.uid, \"sportsDetails\", \"soccer\");\n        const soccerDoc = await getDoc(soccerDocRef);\n        if (userDoc.exists()) {\n          setLoggedInUser(userDoc.data());\n        } else {\n          setLoggedInUser(null);\n        }\n        if (soccerDoc.exists()) {\n          setSoccerDetails(soccerDoc.data());\n        } else {\n          setSoccerDetails(null);\n        }\n      } else {\n        setLoggedInUser(null);\n        setSoccerDetails(null);\n      }\n      setIsLoading(false);\n    });\n    return () => unsubscribe();\n  }, []);\n  const signIn = async (email, password) => {\n    setIsLoading(true);\n    try {\n      await signInWithEmailAndPassword(auth, email, password);\n    } catch (error) {\n      console.error(\"Error signing in:\", error);\n      alert(\"Error: \" + error.message);\n    }\n    setIsLoading(false);\n  };\n  const signUp = async formData => {\n    if (formData.password.length < 6) {\n      alert(\"Password must be at least 6 characters long.\");\n      return;\n    }\n    let userCredential;\n    try {\n      userCredential = await createUserWithEmailAndPassword(auth, formData.email, formData.password);\n      const user = userCredential.user;\n      const userProfileData = {\n        uid: user.uid,\n        playerName: formData.playerName,\n        email: formData.email,\n        phone: formData.phone,\n        address: formData.address,\n        notificationPreference: formData.notificationPreference,\n        comments: formData.comments,\n        role: 'player',\n        photoURL: \"\"\n      };\n      await setDoc(doc(db, \"users\", user.uid), userProfileData);\n      setLoggedInUser(userProfileData);\n    } catch (error) {\n      console.error(\"Error signing up:\", error);\n      alert(\"Error: \" + error.message);\n      if (userCredential && userCredential.user) {\n        try {\n          await deleteUser(userCredential.user);\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    }\n  };\n  const signOutUser = async () => {\n    try {\n      await signOut(auth);\n      setLoggedInUser(null);\n      setSoccerDetails(null);\n    } catch (error) {\n      console.error(\"Error signing out:\", error);\n      alert(\"Error: \" + error.message);\n    }\n  };\n  const uploadProfileImage = async (file, uid) => {\n    if (!file) return null;\n    try {\n      const storageRef = ref(storage, `users/${uid}/profile.jpg`);\n      await uploadBytes(storageRef, file);\n      return await getDownloadURL(storageRef);\n    } catch (error) {\n      console.error(\"Error uploading profile image:\", error);\n      throw error;\n    }\n  };\n  const deleteProfileImage = async uid => {\n    try {\n      const storageRef = ref(storage, `users/${uid}/profile.jpg`);\n      await deleteObject(storageRef);\n    } catch (error) {\n      console.warn(\"Error deleting image (might not exist):\", error);\n    }\n  };\n  const updateProfile = async (profileData, newImageFile = null, removeImage = false) => {\n    if (!loggedInUser) return;\n    if (profileData.email !== loggedInUser.email) {\n      try {\n        await updateEmail(auth.currentUser, profileData.email);\n      } catch (error) {\n        if (error.code === 'auth/requires-recent-login') {\n          setNeedsReauth(true);\n        } else {\n          alert(\"Error: \" + error.message);\n        }\n        return;\n      }\n    }\n    try {\n      let photoURL = loggedInUser.photoURL;\n      if (removeImage) {\n        await deleteProfileImage(loggedInUser.uid);\n        photoURL = \"\";\n      } else if (newImageFile) {\n        photoURL = await uploadProfileImage(newImageFile, loggedInUser.uid);\n      }\n      const dataToUpdate = {\n        playerName: profileData.playerName,\n        phone: profileData.phone,\n        address: profileData.address,\n        notificationPreference: profileData.notificationPreference,\n        comments: profileData.comments,\n        email: profileData.email,\n        photoURL: photoURL || \"\"\n      };\n      const userDocRef = doc(db, \"users\", loggedInUser.uid);\n      await updateDoc(userDocRef, dataToUpdate);\n      await firebaseUpdateProfile(auth.currentUser, {\n        displayName: profileData.playerName,\n        photoURL: photoURL\n      });\n      setLoggedInUser(prevUser => ({\n        ...prevUser,\n        ...dataToUpdate\n      }));\n\n      // NOTE: We still need to update chats when profile changes.\n      // Since we removed `myChats` from here, we fetch them manually just for this update.\n      const chatsRef = collection(db, \"chats\");\n      const q = query(chatsRef, where(\"participants\", \"array-contains\", loggedInUser.uid));\n      const querySnapshot = await getDocs(q);\n      const batchPromises = querySnapshot.docs.map(async chatDoc => {\n        const chatData = chatDoc.data();\n        if (chatData.participantDetails) {\n          const updatedDetails = chatData.participantDetails.map(p => {\n            if (p.uid === loggedInUser.uid) {\n              return {\n                ...p,\n                name: profileData.playerName,\n                email: profileData.email,\n                photoURL: photoURL || \"\"\n              };\n            }\n            return p;\n          });\n          await updateDoc(chatDoc.ref, {\n            participantDetails: updatedDetails\n          });\n        }\n      });\n      await Promise.all(batchPromises);\n      alert(\"Profile successfully updated!\");\n      return true;\n    } catch (error) {\n      alert(\"Error saving profile: \" + error.message);\n      return false;\n    }\n  };\n  const reauthenticate = async (password, newEmail) => {\n    if (!auth.currentUser || !password) return;\n    try {\n      const credential = EmailAuthProvider.credential(auth.currentUser.email, password);\n      await reauthenticateWithCredential(auth.currentUser, credential);\n      await updateEmail(auth.currentUser, newEmail);\n      const userDocRef = doc(db, \"users\", loggedInUser.uid);\n      await updateDoc(userDocRef, {\n        email: newEmail\n      });\n      setLoggedInUser(prevUser => ({\n        ...prevUser,\n        email: newEmail\n      }));\n      alert(\"Email successfully updated!\");\n      setNeedsReauth(false);\n      return true;\n    } catch (error) {\n      alert(\"Error: \" + error.message);\n      return false;\n    }\n  };\n\n  // (Keep updateSoccerDetails, isManager, createRoster, etc. - Roster Logic can stay for now)\n  const updateSoccerDetails = async soccerData => {\n    if (!loggedInUser) return;\n    try {\n      const soccerDataToSave = {\n        ...soccerData,\n        currentRosters: soccerData.currentRosters.split(',').map(item => item.trim()),\n        rosterJerseysOwned: soccerData.rosterJerseysOwned.split(',').map(item => item.trim()),\n        playerNumber: Number(soccerData.playerNumber) || 0\n      };\n      const soccerDocRef = doc(db, \"users\", loggedInUser.uid, \"sportsDetails\", \"soccer\");\n      await setDoc(soccerDocRef, soccerDataToSave);\n      setSoccerDetails(soccerDataToSave);\n      alert(\"Soccer info saved!\");\n      return true;\n    } catch (error) {\n      alert(\"Error: \" + error.message);\n      return false;\n    }\n  };\n  const isManager = () => {\n    return loggedInUser && loggedInUser.role === 'manager';\n  };\n  const createRoster = async (rosterName, season, maxCapacity) => {\n    if (!isManager()) {\n      alert(\"Only managers can create rosters.\");\n      return false;\n    }\n    try {\n      const rosterRef = await addDoc(collection(db, \"rosters\"), {\n        name: rosterName,\n        season: season,\n        maxCapacity: Number(maxCapacity),\n        createdBy: loggedInUser.uid,\n        createdAt: new Date(),\n        playerIDs: [],\n        players: []\n      });\n      // Create associated chat\n      // We can't use `createChat` from here easily without circular deps.\n      // So we manually create the chat document directly here.\n      await addDoc(collection(db, \"chats\"), {\n        type: 'roster',\n        rosterId: rosterRef.id,\n        name: `${rosterName} (${season})`,\n        participants: [loggedInUser.uid],\n        visibleTo: [loggedInUser.uid],\n        participantDetails: [{\n          uid: loggedInUser.uid,\n          name: loggedInUser.playerName,\n          email: loggedInUser.email,\n          photoURL: loggedInUser.photoURL || \"\"\n        }],\n        unreadCounts: {\n          [loggedInUser.uid]: 0\n        },\n        createdAt: serverTimestamp(),\n        lastMessage: \"Team chat created\",\n        lastMessageTime: serverTimestamp()\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const fetchRosters = async () => {\n    try {\n      const querySnapshot = await getDocs(collection(db, \"rosters\"));\n      return querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n    } catch (error) {\n      console.error(error);\n      return [];\n    }\n  };\n  const deleteRoster = async rosterId => {\n    if (!isManager()) return false;\n    try {\n      await deleteDoc(doc(db, \"rosters\", rosterId));\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const addPlayerToRoster = async (rosterId, playerEmail) => {\n    if (!isManager()) return false;\n    try {\n      const usersRef = collection(db, \"users\");\n      const q = query(usersRef, where(\"email\", \"==\", playerEmail));\n      const querySnapshot = await getDocs(q);\n      if (querySnapshot.empty) {\n        alert(\"No player found.\");\n        return false;\n      }\n      const playerDoc = querySnapshot.docs[0];\n      const playerData = playerDoc.data();\n      const playerSummary = {\n        uid: playerDoc.id,\n        playerName: playerData.playerName || \"Unknown\",\n        email: playerData.email,\n        photoURL: playerData.photoURL || \"\"\n      };\n      const rosterRef = doc(db, \"rosters\", rosterId);\n      await updateDoc(rosterRef, {\n        playerIDs: arrayUnion(playerDoc.id),\n        players: arrayUnion(playerSummary)\n      });\n\n      // Update Chat\n      const chatsRef = collection(db, \"chats\");\n      const chatQ = query(chatsRef, where(\"rosterId\", \"==\", rosterId));\n      const chatSnapshot = await getDocs(chatQ);\n      if (!chatSnapshot.empty) {\n        const chatDoc = chatSnapshot.docs[0];\n        await setDoc(chatDoc.ref, {\n          participants: arrayUnion(playerDoc.id),\n          visibleTo: arrayUnion(playerDoc.id),\n          participantDetails: arrayUnion(playerSummary),\n          unreadCounts: {\n            [playerDoc.id]: 0\n          }\n        }, {\n          merge: true\n        });\n      }\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const removePlayerFromRoster = async (rosterId, playerSummary) => {\n    if (!isManager()) return false;\n    try {\n      const rosterRef = doc(db, \"rosters\", rosterId);\n      await updateDoc(rosterRef, {\n        playerIDs: arrayRemove(playerSummary.uid),\n        players: arrayRemove(playerSummary)\n      });\n      const chatsRef = collection(db, \"chats\");\n      const chatQ = query(chatsRef, where(\"rosterId\", \"==\", rosterId));\n      const chatSnapshot = await getDocs(chatQ);\n      if (!chatSnapshot.empty) {\n        const chatDoc = chatSnapshot.docs[0];\n        await updateDoc(chatDoc.ref, {\n          participants: arrayRemove(playerSummary.uid),\n          visibleTo: arrayRemove(playerSummary.uid),\n          participantDetails: arrayRemove(playerSummary)\n        });\n      }\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const fetchUserRosters = async uid => {\n    try {\n      const rostersRef = collection(db, \"rosters\");\n      const q = query(rostersRef, where(\"playerIDs\", \"array-contains\", uid));\n      const querySnapshot = await getDocs(q);\n      return querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n    } catch (error) {\n      console.error(error);\n      return [];\n    }\n  };\n\n  // Generic Event Functions\n  const createEvent = async (rosterId, eventData) => {\n    try {\n      await addDoc(collection(db, \"rosters\", rosterId, \"events\"), {\n        ...eventData,\n        createdAt: new Date()\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const fetchEvents = async rosterId => {\n    try {\n      const eventsRef = collection(db, \"rosters\", rosterId, \"events\");\n      const q = query(eventsRef, orderBy(\"dateTime\", \"asc\"));\n      const querySnapshot = await getDocs(q);\n      return querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n    } catch (error) {\n      console.error(error);\n      return [];\n    }\n  };\n  const deleteEvent = async (rosterId, eventId) => {\n    if (!isManager()) return false;\n    try {\n      await deleteDoc(doc(db, \"rosters\", rosterId, \"events\", eventId));\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const fetchAllUserEvents = async uid => {\n    try {\n      const rosters = await fetchUserRosters(uid);\n      let allEvents = [];\n      for (const roster of rosters) {\n        const eventsRef = collection(db, \"rosters\", roster.id, \"events\");\n        const q = query(eventsRef);\n        const querySnapshot = await getDocs(q);\n        const rosterEvents = querySnapshot.docs.map(doc => ({\n          id: doc.id,\n          rosterName: roster.name,\n          ...doc.data()\n        }));\n        allEvents = [...allEvents, ...rosterEvents];\n      }\n      allEvents.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));\n      return allEvents;\n    } catch (error) {\n      console.error(error);\n      return [];\n    }\n  };\n\n  // Group Functions (Keep here for now or move to separate hook later)\n  const createGroup = async groupData => {\n    try {\n      await addDoc(collection(db, \"groups\"), {\n        ...groupData,\n        createdBy: loggedInUser.uid,\n        createdAt: serverTimestamp(),\n        members: [loggedInUser.uid],\n        memberDetails: [{\n          uid: loggedInUser.uid,\n          name: loggedInUser.playerName,\n          email: loggedInUser.email,\n          photoURL: loggedInUser.photoURL || \"\",\n          role: 'owner'\n        }]\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const fetchUserGroups = async uid => {\n    try {\n      const groupsRef = collection(db, \"groups\");\n      const q = query(groupsRef, where(\"members\", \"array-contains\", uid));\n      const querySnapshot = await getDocs(q);\n      return querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n    } catch (error) {\n      console.error(error);\n      return [];\n    }\n  };\n  const createGroupPost = async (groupId, text, imageUrl = null) => {\n    try {\n      await addDoc(collection(db, \"groups\", groupId, \"posts\"), {\n        text,\n        imageUrl,\n        authorId: loggedInUser.uid,\n        authorName: loggedInUser.playerName,\n        authorPhoto: loggedInUser.photoURL || \"\",\n        createdAt: serverTimestamp(),\n        replies: []\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      return false;\n    }\n  };\n  const addGroupMembers = async (groupId, emails) => {\n    try {\n      const groupRef = doc(db, \"groups\", groupId);\n      const groupSnap = await getDoc(groupRef);\n      if (!groupSnap.exists()) return false;\n      const groupData = groupSnap.data();\n      const myMemberDetails = groupData.memberDetails.find(m => m.uid === loggedInUser.uid);\n      if (!myMemberDetails || myMemberDetails.role !== 'owner' && myMemberDetails.role !== 'admin') {\n        alert(\"Only Owners/Admins can add members.\");\n        return false;\n      }\n      const usersRef = collection(db, \"users\");\n      const newMembers = [];\n      const newMemberIds = [];\n      for (const email of emails) {\n        const q = query(usersRef, where(\"email\", \"==\", email));\n        const snapshot = await getDocs(q);\n        if (!snapshot.empty) {\n          const userDoc = snapshot.docs[0];\n          const userData = userDoc.data();\n          if (!groupData.members.includes(userDoc.id)) {\n            newMemberIds.push(userDoc.id);\n            newMembers.push({\n              uid: userDoc.id,\n              name: userData.playerName || \"Unknown\",\n              email: userData.email,\n              photoURL: userData.photoURL || \"\",\n              role: 'member'\n            });\n          }\n        }\n      }\n      if (newMemberIds.length === 0) return true;\n      await updateDoc(groupRef, {\n        members: arrayUnion(...newMemberIds),\n        memberDetails: arrayUnion(...newMembers)\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const updateGroupMemberRole = async (groupId, memberUid, newRole, currentMemberDetails) => {\n    try {\n      const groupRef = doc(db, \"groups\", groupId);\n      const updatedMemberDetails = currentMemberDetails.map(member => {\n        if (member.uid === memberUid) {\n          return {\n            ...member,\n            role: newRole\n          };\n        }\n        return member;\n      });\n      await updateDoc(groupRef, {\n        memberDetails: updatedMemberDetails\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const transferGroupOwnership = async (groupId, newOwnerUid, currentMemberDetails) => {\n    try {\n      const groupRef = doc(db, \"groups\", groupId);\n      const updatedMemberDetails = currentMemberDetails.map(member => {\n        if (member.uid === loggedInUser.uid) {\n          return {\n            ...member,\n            role: 'admin'\n          };\n        }\n        if (member.uid === newOwnerUid) {\n          return {\n            ...member,\n            role: 'owner'\n          };\n        }\n        return member;\n      });\n      await updateDoc(groupRef, {\n        memberDetails: updatedMemberDetails\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const removeGroupMember = async (groupId, memberUid, currentMemberDetails, currentMembers) => {\n    try {\n      const groupRef = doc(db, \"groups\", groupId);\n      const updatedMemberDetails = currentMemberDetails.filter(m => m.uid !== memberUid);\n      const updatedMembers = currentMembers.filter(uid => uid !== memberUid);\n      await updateDoc(groupRef, {\n        memberDetails: updatedMemberDetails,\n        members: updatedMembers\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      alert(error.message);\n      return false;\n    }\n  };\n  const value = {\n    loggedInUser,\n    soccerDetails,\n    isLoading,\n    needsReauth,\n    setNeedsReauth,\n    signIn,\n    signUp,\n    signOutUser,\n    updateProfile,\n    reauthenticate,\n    updateSoccerDetails,\n    isManager,\n    createRoster,\n    fetchRosters,\n    deleteRoster,\n    addPlayerToRoster,\n    removePlayerFromRoster,\n    fetchUserRosters,\n    createEvent,\n    fetchEvents,\n    deleteEvent,\n    fetchAllUserEvents,\n    uploadImage,\n    // Keeping uploadImage here for now\n    createGroup,\n    fetchUserGroups,\n    createGroupPost,\n    addGroupMembers,\n    updateGroupMemberRole,\n    transferGroupOwnership,\n    removeGroupMember\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 452,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"5MPytths2y1fFmqpbAcpPs27WVo=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","onAuthStateChanged","signInWithEmailAndPassword","createUserWithEmailAndPassword","signOut","updateEmail","updateProfile","firebaseUpdateProfile","EmailAuthProvider","reauthenticateWithCredential","deleteUser","doc","getDoc","setDoc","updateDoc","collection","addDoc","getDocs","deleteDoc","query","where","arrayUnion","arrayRemove","orderBy","serverTimestamp","ref","uploadBytes","getDownloadURL","deleteObject","auth","db","storage","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","AuthProvider","children","_s2","loggedInUser","setLoggedInUser","soccerDetails","setSoccerDetails","isLoading","setIsLoading","needsReauth","setNeedsReauth","unsubscribe","user","userDocRef","uid","userDoc","soccerDocRef","soccerDoc","exists","data","signIn","email","password","error","console","alert","message","signUp","formData","length","userCredential","userProfileData","playerName","phone","address","notificationPreference","comments","role","photoURL","e","signOutUser","uploadProfileImage","file","storageRef","deleteProfileImage","warn","profileData","newImageFile","removeImage","currentUser","code","dataToUpdate","displayName","prevUser","chatsRef","q","querySnapshot","batchPromises","docs","map","chatDoc","chatData","participantDetails","updatedDetails","p","name","Promise","all","reauthenticate","newEmail","credential","updateSoccerDetails","soccerData","soccerDataToSave","currentRosters","split","item","trim","rosterJerseysOwned","playerNumber","Number","isManager","createRoster","rosterName","season","maxCapacity","rosterRef","createdBy","createdAt","Date","playerIDs","players","type","rosterId","id","participants","visibleTo","unreadCounts","lastMessage","lastMessageTime","fetchRosters","deleteRoster","addPlayerToRoster","playerEmail","usersRef","empty","playerDoc","playerData","playerSummary","chatQ","chatSnapshot","merge","removePlayerFromRoster","fetchUserRosters","rostersRef","createEvent","eventData","fetchEvents","eventsRef","deleteEvent","eventId","fetchAllUserEvents","rosters","allEvents","roster","rosterEvents","sort","a","b","dateTime","createGroup","groupData","members","memberDetails","fetchUserGroups","groupsRef","createGroupPost","groupId","text","imageUrl","authorId","authorName","authorPhoto","replies","addGroupMembers","emails","groupRef","groupSnap","myMemberDetails","find","m","newMembers","newMemberIds","snapshot","userData","includes","push","updateGroupMemberRole","memberUid","newRole","currentMemberDetails","updatedMemberDetails","member","transferGroupOwnership","newOwnerUid","removeGroupMember","currentMembers","filter","updatedMembers","value","uploadImage","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/dbroxton/Documents/Projects/soccer-management-app/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport {\n  onAuthStateChanged,\n  signInWithEmailAndPassword,\n  createUserWithEmailAndPassword,\n  signOut,\n  updateEmail,\n  updateProfile as firebaseUpdateProfile,\n  EmailAuthProvider,\n  reauthenticateWithCredential,\n  deleteUser\n} from \"firebase/auth\";\nimport { \n  doc, getDoc, setDoc, updateDoc, collection, addDoc, getDocs, deleteDoc, \n  query, where, arrayUnion, arrayRemove, orderBy, serverTimestamp \n} from \"firebase/firestore\";\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from \"firebase/storage\";\nimport { auth, db, storage } from \"../firebase\"; \n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  return useContext(AuthContext);\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [loggedInUser, setLoggedInUser] = useState(null);\n  const [soccerDetails, setSoccerDetails] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [needsReauth, setNeedsReauth] = useState(false);\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      if (user) {\n        const userDocRef = doc(db, \"users\", user.uid);\n        const userDoc = await getDoc(userDocRef);\n        const soccerDocRef = doc(db, \"users\", user.uid, \"sportsDetails\", \"soccer\");\n        const soccerDoc = await getDoc(soccerDocRef);\n\n        if (userDoc.exists()) {\n          setLoggedInUser(userDoc.data());\n        } else {\n          setLoggedInUser(null);\n        }\n\n        if (soccerDoc.exists()) {\n          setSoccerDetails(soccerDoc.data());\n        } else {\n          setSoccerDetails(null);\n        }\n      } else {\n        setLoggedInUser(null);\n        setSoccerDetails(null);\n      }\n      setIsLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, []); \n\n  const signIn = async (email, password) => {\n    setIsLoading(true);\n    try {\n      await signInWithEmailAndPassword(auth, email, password);\n    } catch (error) {\n      console.error(\"Error signing in:\", error);\n      alert(\"Error: \" + error.message);\n    }\n    setIsLoading(false);\n  };\n\n  const signUp = async (formData) => {\n    if (formData.password.length < 6) {\n      alert(\"Password must be at least 6 characters long.\");\n      return;\n    }\n    let userCredential;\n    try {\n      userCredential = await createUserWithEmailAndPassword(auth, formData.email, formData.password);\n      const user = userCredential.user;\n      const userProfileData = {\n        uid: user.uid,\n        playerName: formData.playerName,\n        email: formData.email,\n        phone: formData.phone,\n        address: formData.address,\n        notificationPreference: formData.notificationPreference,\n        comments: formData.comments,\n        role: 'player', \n        photoURL: \"\"\n      };\n      await setDoc(doc(db, \"users\", user.uid), userProfileData);\n      setLoggedInUser(userProfileData);\n    } catch (error) {\n      console.error(\"Error signing up:\", error);\n      alert(\"Error: \" + error.message);\n      if (userCredential && userCredential.user) {\n        try { await deleteUser(userCredential.user); } catch (e) { console.error(e); }\n      }\n    }\n  };\n\n  const signOutUser = async () => {\n    try {\n      await signOut(auth);\n      setLoggedInUser(null);\n      setSoccerDetails(null);\n    } catch (error) {\n      console.error(\"Error signing out:\", error);\n      alert(\"Error: \" + error.message);\n    }\n  };\n\n  const uploadProfileImage = async (file, uid) => {\n    if (!file) return null;\n    try {\n      const storageRef = ref(storage, `users/${uid}/profile.jpg`);\n      await uploadBytes(storageRef, file);\n      return await getDownloadURL(storageRef);\n    } catch (error) {\n      console.error(\"Error uploading profile image:\", error);\n      throw error;\n    }\n  };\n\n  const deleteProfileImage = async (uid) => {\n    try {\n      const storageRef = ref(storage, `users/${uid}/profile.jpg`);\n      await deleteObject(storageRef);\n    } catch (error) {\n      console.warn(\"Error deleting image (might not exist):\", error);\n    }\n  };\n\n  const updateProfile = async (profileData, newImageFile = null, removeImage = false) => {\n    if (!loggedInUser) return;\n    if (profileData.email !== loggedInUser.email) {\n      try {\n        await updateEmail(auth.currentUser, profileData.email);\n      } catch (error) {\n        if (error.code === 'auth/requires-recent-login') { setNeedsReauth(true); } \n        else { alert(\"Error: \" + error.message); }\n        return;\n      }\n    }\n    try {\n      let photoURL = loggedInUser.photoURL;\n      if (removeImage) {\n        await deleteProfileImage(loggedInUser.uid);\n        photoURL = \"\";\n      } else if (newImageFile) {\n        photoURL = await uploadProfileImage(newImageFile, loggedInUser.uid);\n      }\n      const dataToUpdate = {\n        playerName: profileData.playerName,\n        phone: profileData.phone,\n        address: profileData.address,\n        notificationPreference: profileData.notificationPreference,\n        comments: profileData.comments,\n        email: profileData.email,\n        photoURL: photoURL || \"\"\n      };\n      const userDocRef = doc(db, \"users\", loggedInUser.uid);\n      await updateDoc(userDocRef, dataToUpdate);\n      await firebaseUpdateProfile(auth.currentUser, { displayName: profileData.playerName, photoURL: photoURL });\n      setLoggedInUser(prevUser => ({ ...prevUser, ...dataToUpdate }));\n      \n      // NOTE: We still need to update chats when profile changes.\n      // Since we removed `myChats` from here, we fetch them manually just for this update.\n      const chatsRef = collection(db, \"chats\");\n      const q = query(chatsRef, where(\"participants\", \"array-contains\", loggedInUser.uid));\n      const querySnapshot = await getDocs(q);\n      const batchPromises = querySnapshot.docs.map(async (chatDoc) => {\n        const chatData = chatDoc.data();\n        if (chatData.participantDetails) {\n          const updatedDetails = chatData.participantDetails.map(p => {\n            if (p.uid === loggedInUser.uid) {\n              return { ...p, name: profileData.playerName, email: profileData.email, photoURL: photoURL || \"\" };\n            }\n            return p;\n          });\n          await updateDoc(chatDoc.ref, { participantDetails: updatedDetails });\n        }\n      });\n      await Promise.all(batchPromises);\n\n      alert(\"Profile successfully updated!\");\n      return true; \n    } catch (error) {\n      alert(\"Error saving profile: \" + error.message);\n      return false;\n    }\n  };\n\n  const reauthenticate = async (password, newEmail) => {\n    if (!auth.currentUser || !password) return;\n    try {\n      const credential = EmailAuthProvider.credential(auth.currentUser.email, password);\n      await reauthenticateWithCredential(auth.currentUser, credential);\n      await updateEmail(auth.currentUser, newEmail);\n      const userDocRef = doc(db, \"users\", loggedInUser.uid);\n      await updateDoc(userDocRef, { email: newEmail });\n      setLoggedInUser(prevUser => ({ ...prevUser, email: newEmail }));\n      alert(\"Email successfully updated!\");\n      setNeedsReauth(false); \n      return true; \n    } catch (error) {\n      alert(\"Error: \" + error.message);\n      return false;\n    }\n  };\n\n  // (Keep updateSoccerDetails, isManager, createRoster, etc. - Roster Logic can stay for now)\n  const updateSoccerDetails = async (soccerData) => {\n    if (!loggedInUser) return;\n    try {\n      const soccerDataToSave = {\n        ...soccerData,\n        currentRosters: soccerData.currentRosters.split(',').map(item => item.trim()),\n        rosterJerseysOwned: soccerData.rosterJerseysOwned.split(',').map(item => item.trim()),\n        playerNumber: Number(soccerData.playerNumber) || 0,\n      };\n      const soccerDocRef = doc(db, \"users\", loggedInUser.uid, \"sportsDetails\", \"soccer\");\n      await setDoc(soccerDocRef, soccerDataToSave);\n      setSoccerDetails(soccerDataToSave); \n      alert(\"Soccer info saved!\");\n      return true; \n    } catch (error) { alert(\"Error: \" + error.message); return false; }\n  };\n\n  const isManager = () => { return loggedInUser && loggedInUser.role === 'manager'; };\n\n  const createRoster = async (rosterName, season, maxCapacity) => {\n    if (!isManager()) { alert(\"Only managers can create rosters.\"); return false; }\n    try {\n      const rosterRef = await addDoc(collection(db, \"rosters\"), {\n        name: rosterName, season: season, maxCapacity: Number(maxCapacity),\n        createdBy: loggedInUser.uid, createdAt: new Date(), playerIDs: [], players: [] \n      });\n      // Create associated chat\n      // We can't use `createChat` from here easily without circular deps.\n      // So we manually create the chat document directly here.\n      await addDoc(collection(db, \"chats\"), {\n        type: 'roster', rosterId: rosterRef.id, name: `${rosterName} (${season})`,\n        participants: [loggedInUser.uid], visibleTo: [loggedInUser.uid],\n        participantDetails: [{ uid: loggedInUser.uid, name: loggedInUser.playerName, email: loggedInUser.email, photoURL: loggedInUser.photoURL || \"\" }],\n        unreadCounts: { [loggedInUser.uid]: 0 },\n        createdAt: serverTimestamp(), lastMessage: \"Team chat created\", lastMessageTime: serverTimestamp()\n      });\n      return true;\n    } catch (error) { console.error(error); alert(error.message); return false; }\n  };\n\n  const fetchRosters = async () => {\n    try {\n      const querySnapshot = await getDocs(collection(db, \"rosters\"));\n      return querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n    } catch (error) { console.error(error); return []; }\n  };\n\n  const deleteRoster = async (rosterId) => {\n    if (!isManager()) return false;\n    try { await deleteDoc(doc(db, \"rosters\", rosterId)); return true; } \n    catch (error) { console.error(error); alert(error.message); return false; }\n  };\n\n  const addPlayerToRoster = async (rosterId, playerEmail) => {\n    if (!isManager()) return false;\n    try {\n      const usersRef = collection(db, \"users\");\n      const q = query(usersRef, where(\"email\", \"==\", playerEmail));\n      const querySnapshot = await getDocs(q);\n      if (querySnapshot.empty) { alert(\"No player found.\"); return false; }\n      const playerDoc = querySnapshot.docs[0];\n      const playerData = playerDoc.data();\n      const playerSummary = { uid: playerDoc.id, playerName: playerData.playerName || \"Unknown\", email: playerData.email, photoURL: playerData.photoURL || \"\" };\n      \n      const rosterRef = doc(db, \"rosters\", rosterId);\n      await updateDoc(rosterRef, { playerIDs: arrayUnion(playerDoc.id), players: arrayUnion(playerSummary) });\n      \n      // Update Chat\n      const chatsRef = collection(db, \"chats\");\n      const chatQ = query(chatsRef, where(\"rosterId\", \"==\", rosterId));\n      const chatSnapshot = await getDocs(chatQ);\n      if (!chatSnapshot.empty) {\n        const chatDoc = chatSnapshot.docs[0];\n        await setDoc(chatDoc.ref, {\n          participants: arrayUnion(playerDoc.id),\n          visibleTo: arrayUnion(playerDoc.id),\n          participantDetails: arrayUnion(playerSummary),\n          unreadCounts: { [playerDoc.id]: 0 }\n        }, { merge: true });\n      }\n      return true;\n    } catch (error) { console.error(error); alert(error.message); return false; }\n  };\n\n  const removePlayerFromRoster = async (rosterId, playerSummary) => {\n    if (!isManager()) return false;\n    try {\n      const rosterRef = doc(db, \"rosters\", rosterId);\n      await updateDoc(rosterRef, { playerIDs: arrayRemove(playerSummary.uid), players: arrayRemove(playerSummary) });\n      const chatsRef = collection(db, \"chats\");\n      const chatQ = query(chatsRef, where(\"rosterId\", \"==\", rosterId));\n      const chatSnapshot = await getDocs(chatQ);\n      if (!chatSnapshot.empty) {\n        const chatDoc = chatSnapshot.docs[0];\n        await updateDoc(chatDoc.ref, {\n          participants: arrayRemove(playerSummary.uid), visibleTo: arrayRemove(playerSummary.uid), participantDetails: arrayRemove(playerSummary)\n        });\n      }\n      return true;\n    } catch (error) { console.error(error); alert(error.message); return false; }\n  };\n\n  const fetchUserRosters = async (uid) => {\n    try {\n      const rostersRef = collection(db, \"rosters\");\n      const q = query(rostersRef, where(\"playerIDs\", \"array-contains\", uid));\n      const querySnapshot = await getDocs(q);\n      return querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n    } catch (error) { console.error(error); return []; }\n  };\n\n  // Generic Event Functions\n  const createEvent = async (rosterId, eventData) => {\n    try { await addDoc(collection(db, \"rosters\", rosterId, \"events\"), { ...eventData, createdAt: new Date() }); return true; } \n    catch (error) { console.error(error); alert(error.message); return false; }\n  };\n  const fetchEvents = async (rosterId) => {\n    try {\n      const eventsRef = collection(db, \"rosters\", rosterId, \"events\");\n      const q = query(eventsRef, orderBy(\"dateTime\", \"asc\"));\n      const querySnapshot = await getDocs(q);\n      return querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n    } catch (error) { console.error(error); return []; }\n  };\n  const deleteEvent = async (rosterId, eventId) => {\n    if (!isManager()) return false;\n    try { await deleteDoc(doc(db, \"rosters\", rosterId, \"events\", eventId)); return true; } \n    catch (error) { console.error(error); alert(error.message); return false; }\n  };\n  const fetchAllUserEvents = async (uid) => {\n    try {\n      const rosters = await fetchUserRosters(uid);\n      let allEvents = [];\n      for (const roster of rosters) {\n        const eventsRef = collection(db, \"rosters\", roster.id, \"events\");\n        const q = query(eventsRef); \n        const querySnapshot = await getDocs(q);\n        const rosterEvents = querySnapshot.docs.map(doc => ({ id: doc.id, rosterName: roster.name, ...doc.data() }));\n        allEvents = [...allEvents, ...rosterEvents];\n      }\n      allEvents.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));\n      return allEvents;\n    } catch (error) { console.error(error); return []; }\n  };\n\n  // Group Functions (Keep here for now or move to separate hook later)\n  const createGroup = async (groupData) => {\n     try {\n      await addDoc(collection(db, \"groups\"), { ...groupData, createdBy: loggedInUser.uid, createdAt: serverTimestamp(), members: [loggedInUser.uid], memberDetails: [{ uid: loggedInUser.uid, name: loggedInUser.playerName, email: loggedInUser.email, photoURL: loggedInUser.photoURL || \"\", role: 'owner' }] });\n      return true;\n    } catch (error) { console.error(error); alert(error.message); return false; }\n  };\n  const fetchUserGroups = async (uid) => {\n    try {\n      const groupsRef = collection(db, \"groups\");\n      const q = query(groupsRef, where(\"members\", \"array-contains\", uid));\n      const querySnapshot = await getDocs(q);\n      return querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n    } catch (error) { console.error(error); return []; }\n  };\n  const createGroupPost = async (groupId, text, imageUrl = null) => {\n     try {\n      await addDoc(collection(db, \"groups\", groupId, \"posts\"), { text, imageUrl, authorId: loggedInUser.uid, authorName: loggedInUser.playerName, authorPhoto: loggedInUser.photoURL || \"\", createdAt: serverTimestamp(), replies: [] });\n      return true;\n    } catch (error) { console.error(error); return false; }\n  };\n  const addGroupMembers = async (groupId, emails) => {\n    try {\n      const groupRef = doc(db, \"groups\", groupId);\n      const groupSnap = await getDoc(groupRef);\n      if (!groupSnap.exists()) return false;\n      const groupData = groupSnap.data();\n      const myMemberDetails = groupData.memberDetails.find(m => m.uid === loggedInUser.uid);\n      if (!myMemberDetails || (myMemberDetails.role !== 'owner' && myMemberDetails.role !== 'admin')) { alert(\"Only Owners/Admins can add members.\"); return false; }\n      \n      const usersRef = collection(db, \"users\");\n      const newMembers = [];\n      const newMemberIds = [];\n      for (const email of emails) {\n        const q = query(usersRef, where(\"email\", \"==\", email));\n        const snapshot = await getDocs(q);\n        if (!snapshot.empty) {\n          const userDoc = snapshot.docs[0];\n          const userData = userDoc.data();\n          if (!groupData.members.includes(userDoc.id)) {\n             newMemberIds.push(userDoc.id);\n             newMembers.push({ uid: userDoc.id, name: userData.playerName || \"Unknown\", email: userData.email, photoURL: userData.photoURL || \"\", role: 'member' });\n          }\n        }\n      }\n      if (newMemberIds.length === 0) return true; \n      await updateDoc(groupRef, { members: arrayUnion(...newMemberIds), memberDetails: arrayUnion(...newMembers) });\n      return true;\n    } catch (error) { console.error(error); alert(error.message); return false; }\n  };\n  const updateGroupMemberRole = async (groupId, memberUid, newRole, currentMemberDetails) => {\n    try {\n      const groupRef = doc(db, \"groups\", groupId);\n      const updatedMemberDetails = currentMemberDetails.map(member => {\n        if (member.uid === memberUid) { return { ...member, role: newRole }; }\n        return member;\n      });\n      await updateDoc(groupRef, { memberDetails: updatedMemberDetails });\n      return true;\n    } catch (error) { console.error(error); alert(error.message); return false; }\n  };\n  const transferGroupOwnership = async (groupId, newOwnerUid, currentMemberDetails) => {\n    try {\n      const groupRef = doc(db, \"groups\", groupId);\n      const updatedMemberDetails = currentMemberDetails.map(member => {\n        if (member.uid === loggedInUser.uid) { return { ...member, role: 'admin' }; }\n        if (member.uid === newOwnerUid) { return { ...member, role: 'owner' }; }\n        return member;\n      });\n      await updateDoc(groupRef, { memberDetails: updatedMemberDetails });\n      return true;\n    } catch (error) { console.error(error); alert(error.message); return false; }\n  };\n  const removeGroupMember = async (groupId, memberUid, currentMemberDetails, currentMembers) => {\n    try {\n      const groupRef = doc(db, \"groups\", groupId);\n      const updatedMemberDetails = currentMemberDetails.filter(m => m.uid !== memberUid);\n      const updatedMembers = currentMembers.filter(uid => uid !== memberUid);\n      await updateDoc(groupRef, { memberDetails: updatedMemberDetails, members: updatedMembers });\n      return true;\n    } catch (error) { console.error(error); alert(error.message); return false; }\n  };\n\n  const value = {\n    loggedInUser, soccerDetails, isLoading, needsReauth, setNeedsReauth,\n    signIn, signUp, signOutUser, updateProfile, reauthenticate, updateSoccerDetails,\n    isManager, createRoster, fetchRosters, deleteRoster, addPlayerToRoster, removePlayerFromRoster,\n    fetchUserRosters, createEvent, fetchEvents, deleteEvent, fetchAllUserEvents,\n    uploadImage, // Keeping uploadImage here for now\n    createGroup, fetchUserGroups, createGroupPost, addGroupMembers, updateGroupMemberRole, transferGroupOwnership, removeGroupMember\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}